"use strict";var Ye=Object.defineProperty;var o=(l,S)=>Ye(l,"name",{value:S,configurable:!0});var h=(l,S)=>()=>(S||l((S={exports:{}}).exports,S),S.exports);var ce=h((qe,se)=>{"use strict";se.exports={number:"NUMBER",string:"TEXT",date:"DATE",timestamp:"TIMESTAMP",binary:"BINARY",boolean:"BIT",document:"LONGTEXT",array:"LONGTEXT",objectId:"VARCHAR(24)",default:"CHAR"}});var Ee=h((Ge,me)=>{"use strict";me.exports={TINYINT:{capacity:1},SMALLINT:{capacity:2},MEDIUMINT:{capacity:3},INT:{capacity:4},INTEGER:{capacity:4},BIGINT:{capacity:8},INT1:{capacity:1},INT2:{capacity:2},INT3:{capacity:3},INT4:{capacity:4},INT8:{capacity:8},FLOAT:{capacity:4,mode:"floating"},DOUBLE:{capacity:8,mode:"floating"},"DOUBLE PRECISION":{capacity:8,mode:"floating"},REAL:{capacity:8,mode:"floating"},DECIMAL:{capacity:16,mode:"decimal"},DEC:{capacity:16,mode:"decimal"},NUMERIC:{capacity:16,mode:"decimal"},FIXED:{capacity:16,mode:"decimal"},NUMBER:{capacity:16,mode:"decimal"},CHAR:{size:1},VARCHAR:{mode:"varying"},TINYTEXT:{size:255,mode:"text"},TEXT:{size:65535,mode:"text"},MEDIUMTEXT:{size:16777215,mode:"text"},LONGTEXT:{size:4294967295,mode:"text"},JSON:{size:4294967295,mode:"text"},BINARY:{mode:"binary"},"CHAR BYTE":{mode:"binary"},VARBINARY:{size:2147483649,mode:"binary"},TINYBLOB:{size:255,mode:"binary"},BLOB:{size:65535,mode:"binary"},MEDIUMBLOB:{size:16777215,mode:"binary"},LONGBLOB:{size:4294967295,mode:"binary"},BIT:{mode:"boolean"},DATE:{format:"YYYY-MM-DD"},TIME:{format:"hh:mm:ss.nnnnnn"},DATETIME:{format:"YYYY-MM-DD hh:mm:ss"},TIMESTAMP:{format:"YYYY-MM-DD hh:mm:ss"},YEAR:{format:"YYYY"},INET6:{mode:"ip"},ENUM:{mode:"enum"},SET:{mode:"enum"},GEOMETRY:{format:"euclidian",mode:"geospatial"},POINT:{format:"euclidian",mode:"geospatial"},LINESTRING:{format:"euclidian",mode:"geospatial"},POLYGON:{format:"euclidian",mode:"geospatial"},MULTIPOINT:{format:"euclidian",mode:"geospatial"},MULTILINESTRING:{format:"euclidian",mode:"geospatial"},MULTIPOLYGON:{format:"euclidian",mode:"geospatial"},GEOMETRYCOLLECTION:{format:"euclidian",mode:"geospatial"}}});var Te=h((He,le)=>{"use strict";le.exports={createDatabase:"CREATE${orReplace} DATABASE${ifNotExist} `${name}`${dbOptions};\n\n${useDb}",createTable:"CREATE ${orReplace}${temporary}TABLE ${ifNotExist}${name} (\n	${column_definitions}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n)${options}${partitions}${selectStatement};\n",createLikeTable:"CREATE ${orReplace}${temporary}TABLE ${ifNotExist}${name} LIKE ${likeTableName};\n",columnDefinition:"`${name}` ${national}${type}${signed}${primary_key}${unique_key}${default}${autoIncrement}${zeroFill}${not_null}${invisible}${compressed}${charset}${collate}${comment}",checkConstraint:"CONSTRAINT ${name}CHECK (${expression})",createForeignKeyConstraint:"CONSTRAINT `${name}` FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey})",createKeyConstraint:"${constraintName}${keyType}${columns}${using}${blockSize}${comment}${ignore}",createForeignKey:"ALTER TABLE ${foreignTable} ADD CONSTRAINT `${name}` FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey});",addCheckConstraint:"ALTER TABLE ${tableName} ADD CONSTRAINT ${constraintName} CHECK (${expression});",addPkConstraint:"ALTER TABLE ${tableName} ADD ${constraintStatement};",dropPrimaryKey:"ALTER TABLE ${tableName} DROP PRIMARY KEY;",dropConstraint:"ALTER TABLE ${tableName} DROP CONSTRAINT ${constraintName};",dropDatabase:"DROP DATABASE IF EXISTS ${databaseName};",dropProcedure:"DROP PROCEDURE IF EXISTS ${procedureName};",dropFunction:"DROP FUNCTION IF EXISTS ${functionName};",updateCommentOnTable:"ALTER TABLE ${tableName} COMMENT ${comment};",updateCommentOnSchema:"ALTER SCHEMA ${schemaName} COMMENT = ${comment};",alterCollation:"ALTER DATABASE ${databaseName} CHARACTER SET=${characterSet} COLLATE=${collation};",dropTable:"DROP TABLE IF EXISTS ${tableName};",dropColumn:"ALTER TABLE IF EXISTS ${tableName} DROP COLUMN IF EXISTS ${columnName};",addColumn:"ALTER TABLE IF EXISTS ${tableName} ADD COLUMN IF NOT EXISTS ${columnDefinition};",modifyColumn:"ALTER TABLE ${tableName} MODIFY COLUMN IF EXISTS ${columnDefinition};",dropView:"DROP VIEW IF EXISTS ${viewName};",renameColumn:"ALTER TABLE IF EXISTS ${tableName} RENAME COLUMN ${oldName} TO ${newName};",modifyTableOptions:"ALTER TABLE ${tableName} ${defaultKeyword}${characterSetDefinition}${collateDefinition};",index:"CREATE ${indexType}INDEX ${ifNotExist}${name}${indexCategory}\n	ON ${table} ( ${keys} )${indexOptions};\n",dropIndex:"ALTER TABLE ${tableName} DROP INDEX IF EXISTS ${indexName};",createView:"CREATE ${orReplace}${algorithm}${sqlSecurity}VIEW ${ifNotExist}${name} AS ${selectStatement}${checkOption};\n",viewSelectStatement:"SELECT ${keys}\n	FROM ${tableName}",createFunction:"CREATE ${orReplace}${aggregate}FUNCTION ${ifNotExist}${name}\n	(${parameters})\n	RETURNS ${type}\n	${characteristics}\n${body}${delimiter}\n",createProcedure:"CREATE ${orReplace}PROCEDURE ${name} (${parameters})\n	${characteristics}\n${body}${delimiter}\n",alterView:"ALTER VIEW ${name}${algorithm}${sqlSecurity} AS ${selectStatement}"}});var Q=h((ve,ue)=>{"use strict";var w=class w{name;type;primaryKey;primaryKeyOptions;unique;uniqueKeyOptions;nullable;default;comment;isActivated;scale;precision;length;national;autoIncrement;zerofill;invisible;compressionMethod;enum;synonym;signed;microSecPrecision;charset;collation};o(w,"HydratedColumn");var z=w;ue.exports={HydratedColumn:z}});var j=h((We,Ne)=>{"use strict";var J=class J{name;type;nullable;primaryKey;default;length;scale;precision;hasMaxLength;isActivated;unique;zerofill;autoIncrement;invisible;national;comment;charset;compressionMethod;signed;microSecPrecision;enum};o(J,"ColumnDefinition");var Z=J;Ne.exports={ColumnDefinition:Z}});var ne=h((ke,Ie)=>{"use strict";var te=class te{name;isActivated};o(te,"KeyJsonSchema");var ee=te;Ie.exports={KeyJsonSchema:ee}});var de=h((Ze,pe)=>{"use strict";var{ColumnDefinition:we}=j(),{HydratedColumn:Qe}=Q();pe.exports=(l,S)=>{let $=o((i,m)=>`${i}(${m})`,"addLength"),p=o((i,m,B)=>l.isNumber(B)?`${i}(${m},${B})`:`${i}(${m})`,"addScalePrecision"),M=o((i,m)=>`${i}(${m})`,"addPrecision"),L=o(i=>["CHAR","VARCHAR","BINARY","CHAR BYTE","VARBINARY","BLOB"].includes(i),"canHaveLength"),C=o(i=>["TINYINT","SMALLINT","MEDIUMINT","INT","INTEGER","BIGINT","INT1","INT2","INT3","INT4","INT8","FLOAT","DOUBLE","REAL","DECIMAL","DEC","NUMERIC","FIXED","NUMBER","DOUBLE PRECISION","BIT"].includes(i),"isNumeric"),K=o(i=>C(i),"canHavePrecision"),x=o(i=>["TIME","DATETIME","TIMESTAMP"].includes(i),"canHaveMicrosecondPrecision"),b=o(i=>["DECIMAL","FLOAT","DOUBLE","DEC","FIXED","NUMERIC","NUMBER","DOUBLE PRECISION","REAL"].includes(i),"canHaveScale"),_=o((i,m)=>L(i)&&l.isNumber(m.length)?$(i,m.length):K(i)&&b(i)&&l.isNumber(m.precision)?p(i,m.precision,m.scale):K(i)&&l.isNumber(m.precision)?M(i,m.precision):x(i)&&l.isNumber(m.microSecPrecision)?M(i,m.microSecPrecision):["ENUM","SET"].includes(i)&&!l.isEmpty(m.enum)?`${i}('${m.enum.join("', '")}')`:i,"decorateType"),c=o(i=>["CHAR","VARCHAR","TEXT","TINYTEXT","MEDIUMTEXT","LONGTEXT"].includes(l.toUpper(i)),"isString"),y=o(i=>["TIME","DATE","DATETIME","TIMESTAMP"].includes(i),"isDateTime"),u=o(i=>l.trim(i).replace(/(')+/g,"'$1"),"escapeQuotes");return{decorateType:_,decorateDefault:o((i,m)=>{let B=["current_timestamp","null"];return(c(i)||y(i))&&!B.includes(l.toLower(m))?S(u(m)):m},"decorateDefault"),canBeNational:o(i=>["CHAR","VARCHAR"].includes(i),"canBeNational"),isNumeric:C,getSign:o((i,m)=>C(i)&&m===!1?" UNSIGNED":"","getSign"),canHaveAutoIncrement:o(i=>["tinyint","smallint","mediumint","int","bigint"].includes(i),"canHaveAutoIncrement")}}});var Se=h((je,Ae)=>{"use strict";var Ue=Object.freeze({ENGINE:"ENGINE",AUTO_INCREMENT:"AUTO_INCREMENT",AVG_ROW_LENGTH:"AVG_ROW_LENGTH",CHECKSUM:"CHECKSUM",DATA_DIRECTORY:"DATA DIRECTORY",DELAY_KEY_WRITE:"DELAY_KEY_WRITE",INDEX_DIRECTORY:"INDEX DIRECTORY",ENCRYPTED:"ENCRYPTED",ENCRYPTION_KEY_ID:"ENCRYPTION_KEY_ID",IETF_QUOTES:"IETF_QUOTES",INSERT_METHOD:"INSERT_METHOD",UNION:"UNION",KEY_BLOCK_SIZE:"KEY_BLOCK_SIZE",MIN_ROWS:"MIN_ROWS",MAX_ROWS:"MAX_ROWS",PACK_KEYS:"PACK_KEYS",PAGE_CHECKSUM:"PAGE_CHECKSUM",PAGE_COMPRESSED:"PAGE_COMPRESSED",PAGE_COMPRESSION_LEVEL:"PAGE_COMPRESSION_LEVEL",ROW_FORMAT:"ROW_FORMAT",SEQUENCE:"SEQUENCE",STATS_AUTO_RECALC:"STATS_AUTO_RECALC",STATS_PERSISTENT:"STATS_PERSISTENT",TRANSACTIONAL:"TRANSACTIONAL",WITH_SYSTEM_VERSIONING:"WITH SYSTEM VERSIONING"}),he=Object.freeze({MyISAM:["AUTO_INCREMENT","AVG_ROW_LENGTH","CHECKSUM","DATA_DIRECTORY","DELAY_KEY_WRITE","INDEX_DIRECTORY","KEY_BLOCK_SIZE","PACK_KEYS","ROW_FORMAT","WITH_SYSTEM_VERSIONING"],InnoDB:["AUTO_INCREMENT","DATA_DIRECTORY","INDEX_DIRECTORY","ENCRYPTED","ENCRYPTION_KEY_ID","KEY_BLOCK_SIZE","PACK_KEYS","PAGE_COMPRESSED","PAGE_COMPRESSION_LEVEL","ROW_FORMAT","SEQUENCE","STATS_AUTO_RECALC","STATS_PERSISTENT","WITH_SYSTEM_VERSIONING"],CSV:["IETF_QUOTES","KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"],MERGE:["INSERT_METHOD","UNION","KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"],Aria:["AUTO_INCREMENT","AVG_ROW_LENGTH","CHECKSUM","DATA_DIRECTORY","DELAY_KEY_WRITE","INDEX_DIRECTORY","PAGE_CHECKSUM","ROW_FORMAT","KEY_BLOCK_SIZE","PACK_KEYS","TRANSACTIONAL","WITH_SYSTEM_VERSIONING"],Memory:["AUTO_INCREMENT","KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"],Archive:["AUTO_INCREMENT","KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"]});Ae.exports={TableOptions:Ue,TableOptionsByEngine:he}});var ye=h((et,Ce)=>{"use strict";var{TableOptionsByEngine:Be,TableOptions:Re}=Se();Ce.exports=({_:l,wrap:S})=>{let $=o((t,r)=>r?`\`${r}\`.\`${t}\``:`\`${t}\``,"getNamePrefixedWithSchemaName"),p=o((t,r)=>$(t,r),"getTableName"),M=o((t,r)=>$(t,r),"getProcedureName"),L=o((t,r)=>$(t,r),"getUdfName"),C=o(t=>`\`${t}\``,"wrapDbName"),K=o((t,r)=>{if(["ROW_FORMAT","INSERT_METHOD"].includes(t))return r?l.toUpper(r):void 0;if(t==="UNION")return r;if(["YES","NO","DEFAULT"].includes(l.toUpper(r)))return l.toUpper(r);if(typeof r=="number")return r;if(!isNaN(+r)&&r)return+r;if(typeof r=="string"&&r)return S(r);if(typeof r=="boolean")return r?"YES":"NO"},"getOptionValue"),x=o((t="")=>t.replace(/(?<!\\)('|"|`)/gi,"\\$1").replace(/\n/gi,"\\n"),"encodeStringLiteral"),b=o((t={})=>{let r=[],s=t.ENGINE;return t.defaultCharSet||(t.characterSet&&r.push(`CHARSET=${t.characterSet}`),t.collation&&r.push(`COLLATE=${t.collation}`)),s&&r.push(`ENGINE = ${s}`),t.description&&r.push(`COMMENT = '${x(t.description)}'`),(Be[s]||["KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"]).forEach(N=>{if(N==="WITH_SYSTEM_VERSIONING")return t[N]?r.push(Re[N]):void 0;let A=K(N,t[N]);if(A===void 0)return;let I=`${Re[N]} = ${A}`;r.push(I)}),r.length?" "+r.join(`,
	`):""},"getTableOptions"),_=o(t=>t?"LINEAR ":"","addLinear"),c=o(t=>{if(t.partitionType==="SYSTEM_TIME"){let r=!isNaN(t.interval)&&t.interval?` INTERVAL ${t.interval}`:"";return r&&t.time_unit&&(r+=` ${t.time_unit}`),`SYSTEM_TIME${r}`}return`${_(t.LINEAR)}${t.partitionType}(${l.trim(t.partitioning_expression)})`},"getPartitionBy"),y=o(t=>t.subpartitionType?`SUBPARTITION BY ${_(t.SUBLINEAR)}${t.subpartitionType}(${l.trim(t.subpartitioning_expression)})`:"","getSubPartitionBy"),u=o(t=>{if(!Array.isArray(t.partition_definitions))return"";let r=t.partition_definitions.filter(({partitionDefinition:s})=>s).map(s=>{let E=s.subpartitionDefinition;return E?s.partitionDefinition+" "+S(E,"(",")"):s.partitionDefinition}).join(`,
		`);return r?S(`
		`+r+`
	`,"(",")"):""},"getPartitionDefinitions"),f=o((t={})=>{if(!t.partitionType)return"";let r=`PARTITION BY ${c(t)}`,s=t.partitions?`PARTITIONS ${t.partitions}`:"",E=y(t),N=t.subpartitions?`SUBPARTITIONS ${t.subpartitions}`:"",A=u(t),I=[r,s,E,N,A].filter(Boolean);return I.length?`
	`+I.join(`
	`):""},"getPartitions"),d=o(t=>t?t.alias?`\`${t.name}\` as \`${t.alias}\``:`\`${t.name}\``:"","getKeyWithAlias"),Y=o(t=>Array.isArray(t)?t.reduce((r,s)=>{if(!s.tableName)return r.columns.push(d(s)),r;let E=`\`${s.dbName}\`.\`${s.tableName}\``;return r.tables.includes(E)||r.tables.push(E),r.columns.push({statement:`${E}.${d(s)}`,isActivated:s.isActivated}),r},{tables:[],columns:[]}):{tables:[],columns:[]},"getViewData"),a=o(t=>{let r=[];return t.language&&r.push("LANGUAGE SQL"),t.deterministic&&r.push(t.deterministic),t.sqlSecurity&&r.push(`SQL SECURITY ${t.sqlSecurity}`),t.comment&&r.push(`COMMENT ${S(i(t.comment))}`),r},"getCharacteristics"),i=o((t="")=>t.replace(/(')/gi,"'$1").replace(/\n/gi,"\\n"),"escapeQuotes");return{getTableName:p,getCollectionName:o(t=>(t==null?void 0:t.code)||(t==null?void 0:t.collectionName)||(t==null?void 0:t.name),"getCollectionName"),getCollectionSchema:o(t=>({...t,...l.omit(t==null?void 0:t.role,"properties")||{}}),"getCollectionSchema"),getDatabaseName:o(t=>{var r;return(r=t.compMod)==null?void 0:r.keyspaceName},"getDatabaseName"),wrapDbName:C,getContainerName:o(t=>t.code||t.name||t.collectionName,"getContainerName"),getModifiedGroupItemsByName:o((t=[],r=[])=>{let s=t.filter(A=>!r.some(I=>I.name===A.name)),E=[],N=[];for(let A of r){let I=t.find(O=>O.name===A.name);if(!I){E.push(A);continue}!l.isEqual(I,A)&&N.push(I)}return{added:s,removed:E,modified:N}},"getModifiedGroupItemsByName"),getProcedureName:M,getUdfName:L,getTableOptions:b,getPartitions:f,getViewData:Y,getCharacteristics:a,escapeQuotes:i,checkFieldPropertiesChanged:o((t,r)=>r.some(s=>(t==null?void 0:t.oldField[s])!==(t==null?void 0:t.newField[s])),"checkFieldPropertiesChanged"),getCompMod:o(t=>{var r;return((r=t.role)==null?void 0:r.compMod)??{}},"getCompMod"),checkCompModEqual:o(({new:t,old:r}={},s)=>s.isEqual(t,r),"checkCompModEqual"),getViewSchema:o(t=>({...t,...t.role??{}}),"getViewSchema"),getViewName:o(t=>t.code||t.name,"getViewName"),wrapInTics:o(t=>`\`${t}\``,"wrapInTics"),wrapInSingleQuotes:o(t=>`'${t}'`,"wrapInSingleQuotes"),commentIfDeactivated:o((t,{isActivated:r,isPartOfLine:s,inlineComment:E="--"})=>t?r!==!1?t:s?"/* "+t+" */":t.includes(`
`)?`/*
`+t+` */
`:E+" "+t:"","commentIfDeactivated"),getNamePrefixedWithSchemaName:$}}});var fe=h((rt,Oe)=>{"use strict";var{KeyJsonSchema:nt}=ne();Oe.exports=({_:l,commentIfDeactivated:S,checkAllKeysDeactivated:$,divideIntoActivatedAndDeactivated:p,assignTemplates:M,escapeQuotes:L})=>{let C=o((c,y)=>{var Y,a;let u=S(((c==null?void 0:c.deactivatedItems)||[]).join(`,
	`),{isActivated:!y,isPartOfLine:!0}),f=(Y=c==null?void 0:c.activatedItems)!=null&&Y.length?`,
	`+c.activatedItems.join(`,
	`):"",d=(a=c==null?void 0:c.deactivatedItems)!=null&&a.length?`
	`+u:"";return f+d},"generateConstraintsString"),K=o(c=>{if(Array.isArray(c)){let y=c.filter(d=>l.get(d,"isActivated",!0)).map(d=>`\`${l.trim(d.name)}\``),u=c.filter(d=>!l.get(d,"isActivated",!0)).map(d=>`\`${l.trim(d.name)}\``),f=u.length?S(u,{isActivated:!1,isPartOfLine:!0}):"";return y.join(", ")+f}return c},"foreignKeysToString"),x=o(c=>c.map(y=>l.trim(y.name)).join(", "),"foreignActiveKeysToString"),b=o((c,y)=>u=>{let f=$(u.columns||[]),d=_(f,y,u.columns),Y=u.category?` USING ${u.category}`:"",a=u.ignore?" IGNORED":"",i=u.comment?` COMMENT '${L(u.comment)}'`:"",m=u.blockSize?` KEY_BLOCK_SIZE=${u.blockSize}`:"";return{statement:M(c.createKeyConstraint,{constraintName:u.name?`CONSTRAINT \`${l.trim(u.name)}\` `:"",keyType:u.keyType,blockSize:m,columns:d,comment:i,ignore:a,using:Y}),isActivated:!f}},"createKeyConstraint"),_=o((c,y,u)=>{var a;if(!u)return"";let f=o(({name:i,order:m})=>`\`${i}\` ${m}`.trim(),"columnMapToString"),d=p(u,f),Y=(a=d==null?void 0:d.deactivatedItems)!=null&&a.length?S(d.deactivatedItems.join(", "),{isActivated:!1,isPartOfLine:!0}):"";return!c&&y?" ("+d.activatedItems.join(", ")+Y+")":" ("+u.map(f).join(", ")+")"},"getKeyColumns");return{generateConstraintsString:C,foreignKeysToString:K,foreignActiveKeysToString:x,createKeyConstraint:b}}});var $e=h((at,ge)=>{"use strict";ge.exports=(l,S)=>{let $=o((a,i)=>Object.entries(a.properties).map(i),"mapProperties"),p=o(a=>a.compositeUniqueKey?!1:a.unique,"isUniqueKey"),M=o(a=>{var i,m;return p(a)&&(((i=a.uniqueKeyOptions)==null?void 0:i.length)===1&&!((m=l.first(a.uniqueKeyOptions))!=null&&m.constraintName)||l.isEmpty(a.uniqueKeyOptions))},"isInlineUnique"),L=o(a=>a.compositeUniqueKey||a.compositePrimaryKey?!1:a.primaryKey,"isPrimaryKey"),C=o(a=>{var i;return L(a)&&!((i=a.primaryKeyOptions)!=null&&i.constraintName)},"isInlinePrimaryKey"),K=o(a=>l.toLower(a)==="asc"?"ASC":l.toLower(a)==="desc"?"DESC":"","getOrder"),x=o(a=>`\`${a.name}\`${a.type==="DESC"?" DESC":""}`,"mapKeyOrder"),b=o((a,i,m)=>S({keyType:"UNIQUE",name:a.constraintName,columns:[{name:i,order:K(a.order),isActivated:m}],category:a.indexCategory,ignore:a.indexIgnore,comment:a.indexComment,blockSize:a.indexBlockSize}),"hydrateUniqueOptions"),_=o((a,i,m)=>S({keyType:"PRIMARY KEY",name:a.constraintName,columns:[{name:i,order:K(a.order),isActivated:m}],category:a.indexCategory,ignore:a.indexIgnore,comment:a.indexComment,blockSize:a.indexBlockSize}),"hydratePrimaryKeyOptions"),c=o((a,i)=>Object.keys(i).find(m=>i[m].GUID===a),"findName"),y=o((a,i)=>l.get(Object.values(i).find(m=>m.GUID===a),"isActivated",!0),"checkIfActivated"),u=o((a,i)=>a.map(m=>({name:c(m.keyId,i.properties),order:m.type==="descending"?"DESC":"ASC",isActivated:y(m.keyId,i.properties)})),"getKeys"),f=o(a=>Array.isArray(a.primaryKey)?a.primaryKey.filter(i=>!l.isEmpty(i.compositePrimaryKey)).map(i=>({..._(i),columns:u(i.compositePrimaryKey,a)})):[],"getCompositePrimaryKeys"),d=o(a=>Array.isArray(a.uniqueKey)?a.uniqueKey.filter(i=>!l.isEmpty(i.compositeUniqueKey)).map(i=>({...b(i),columns:u(i.compositeUniqueKey,a)})):[],"getCompositeUniqueKeys");return{getTableKeyConstraints:o(({jsonSchema:a})=>{if(!a.properties)return[];let i=$(a,([B,P])=>{if(!(!L(P)||C(P)))return _(P.primaryKeyOptions,B,P.isActivated)}).filter(Boolean),m=l.flatten($(a,([B,P])=>!p(P)||M(P)?[]:(P.uniqueKeyOptions||[]).map(F=>b(F,B,P.isActivated)))).filter(Boolean);return[...i,...f(a),...m,...d(a)]},"getTableKeyConstraints"),isInlineUnique:M,isInlinePrimaryKey:C,hydratePrimaryKeyOptions:_,hydrateUniqueOptions:b,mapKeyOrder:x}}});var Me=h((Et,Ke)=>{"use strict";var xe=ce(),Le=Ee(),T=Te(),{HydratedColumn:st}=Q(),{ColumnDefinition:ct}=j(),{KeyJsonSchema:mt}=ne();Ke.exports=(l,S,$)=>{let p=$.require("lodash"),{tab:M,commentIfDeactivated:L,checkAllKeysDeactivated:C,divideIntoActivatedAndDeactivated:K,hasType:x,wrap:b,clean:_}=$.require("@hackolade/ddl-fe-utils").general,{assignTemplates:c}=$.require("@hackolade/ddl-fe-utils"),{decorateDefault:y,decorateType:u,canBeNational:f,getSign:d,canHaveAutoIncrement:Y}=de()(p,b),{getTableName:a,getTableOptions:i,getPartitions:m,getViewData:B,getCharacteristics:P,escapeQuotes:F,wrapInTics:re}=ye()({_:p,wrap:b}),{generateConstraintsString:W,foreignKeysToString:H,foreignActiveKeysToString:X,createKeyConstraint:v}=fe()({_:p,commentIfDeactivated:L,checkAllKeysDeactivated:C,divideIntoActivatedAndDeactivated:K,assignTemplates:c,escapeQuotes:F}),q=$e()(p,_),V=o(e=>{let n=p.toUpper(e.type),t=e.nullable?"":" NOT NULL",r=e.primaryKey?" "+v(T,!0)(e.primaryKeyOptions).statement:"",s=e.unique?" "+v(T,!0)(e.uniqueKeyOptions).statement:"",E=e.zerofill?" ZEROFILL":"",N=e.autoIncrement?" AUTO_INCREMENT":"",A=e.invisible?" INVISIBLE":"",I=e.national&&f(n)?"NATIONAL ":"",g=e.comment?` COMMENT '${F(e.comment)}'`:"",O=n!=="JSON"&&e.charset?` CHARSET ${e.charset}`:"",R=n!=="JSON"&&e.charset&&e.collation?` COLLATE ${e.collation}`:"",U=p.isUndefined(e.default)?"":" DEFAULT "+y(n,e.default),D=e.compressionMethod?` COMPRESSED=${e.compressionMethod}`:"",G=d(n,e.signed);return c(T.columnDefinition,{name:e.name,type:u(n,e),not_null:t,primary_key:r,unique_key:s,default:U,autoIncrement:N,compressed:D,signed:G,zeroFill:E,invisible:A,comment:g,national:I,charset:O,collate:R})},"mapColumnToColumnDefinitionDdl");return{createDatabase({databaseName:e,orReplace:n,ifNotExist:t,collation:r,characterSet:s,comments:E,udfs:N,procedures:A,useDb:I=!0}){let g="";g+=s?M(`
CHARACTER SET = '${s}'`):"",g+=r?M(`
COLLATE = '${r}'`):"",g+=E?M(`
COMMENT = '${F(E)}'`):"";let O=c(T.createDatabase,{name:e,orReplace:n&&!t?" OR REPLACE":"",ifNotExist:t?" IF NOT EXISTS":"",dbOptions:g,useDb:I?`USE \`${e}\`;
`:""}),R=N.map(D=>this.createUdf(e,D)),U=A.map(D=>this.createProcedure(e,D));return[O,...R,...U].join(`
`)},createTable({name:e,columns:n,dbData:t,temporary:r,orReplace:s,ifNotExist:E,likeTableName:N,selectStatement:A,options:I,partitioning:g,checkConstraints:O,foreignKeyConstraints:R,keyConstraints:U},D){let G=a(e,t.databaseName),ie=s?"OR REPLACE ":"",ae=r?"TEMPORARY ":"",oe=E?"IF NOT EXISTS ":"";if(N)return c(T.createLikeTable,{name:G,likeTableName:a(N,t.databaseName),orReplace:ie,temporary:ae,ifNotExist:oe});let be=K(U.map(v(T,D)),k=>k.statement),Pe=W(be,D),De=K(R,k=>k.statement),_e=W(De,D);return c(T.createTable,{name:G,column_definitions:n.join(`,
	`),selectStatement:A?` ${A}`:"",orReplace:ie,temporary:ae,ifNotExist:oe,options:i(I),partitions:m(g),checkConstraints:O.length?`,
	`+O.join(`,
	`):"",foreignKeyConstraints:_e,keyConstraints:Pe})},mapColumnToColumnDefinitionDdl:V,convertColumnDefinition(e){let n=V(e),t={isActivated:e.isActivated};return L(n,t)},createIndex(e,n,t,r=!0){if(p.isEmpty(n.indxKey)||!n.indxName)return"";let s=C(n.indxKey),E=n.isActivated===!1||!r||s,N=n.indexType?`${p.toUpper(n.indexType)} `:"",A=n.ifNotExist?"IF NOT EXISTS ":"",I=b(n.indxName,"`","`"),g=a(e,t.databaseName),O=n.indexCategory?` USING ${n.indexCategory}`:"",R=[],U=K(n.indxKey,q.mapKeyOrder),D=U.deactivatedItems.length?L(U.deactivatedItems.join(", "),{isActivated:E,isPartOfLine:!0}):"";p.toLower(n.waitNoWait)==="wait"&&n.waitValue&&R.push(`WAIT ${n.waitValue}`),p.toLower(n.waitNoWait)==="nowait"&&R.push("NOWAIT"),n.indexComment&&R.push(`COMMENT '${F(n.indexComment)}'`),n.indexLock?R.push(`LOCK ${n.indexLock}`):n.indexAlgorithm&&R.push(`ALGORITHM ${n.indexAlgorithm}`);let G=c(T.index,{keys:U.activatedItems.join(", ")+(E&&D&&U.activatedItems.length?", "+D:D),indexOptions:R.length?`
	`+R.join(`
	`):"",name:I,table:g,indexType:N,ifNotExist:A,indexCategory:O});return E?L(G,{isActivated:!1}):G},createCheckConstraint(e){return c(T.checkConstraint,{name:e.name?`${b(e.name,"`","`")} `:"",expression:p.trim(e.expression).replace(/^\(([\s\S]*)\)$/,"$1")})},createForeignKeyConstraint({name:e,foreignKey:n,primaryTable:t,primaryKey:r,primaryTableActivated:s,foreignTableActivated:E,primarySchemaName:N},A,I){let g=C(r),O=C(n),R=!g&&!O&&s&&E;return{statement:c(T.createForeignKeyConstraint,{primaryTable:a(t,N||I.schemaName),name:e,foreignKey:R?H(n):X(n),primaryKey:R?H(r):X(r)}),isActivated:R}},createForeignKey({name:e,foreignTable:n,foreignKey:t,primaryTable:r,primaryKey:s,primaryTableActivated:E,foreignTableActivated:N,foreignSchemaName:A,primarySchemaName:I},g,O){let R=C(s),U=C(t);return{statement:c(T.createForeignKey,{primaryTable:a(r,I||O.schemaName),foreignTable:a(n,A||O.schemaName),name:e,foreignKey:H(t),primaryKey:H(s)}),isActivated:!R&&!U&&E&&N}},createViewForAlterScript(e,n){let{deactivatedWholeStatement:t,selectStatement:r}=this.viewSelectStatement(e),s=e.algorithm&&e.algorithm!=="UNDEFINED"?`ALGORITHM ${e.algorithm} `:"",E=c(T.createView,{name:a(e.name,n),orReplace:e.orReplace?"OR REPLACE ":"",ifNotExist:e.ifNotExist?"IF NOT EXISTS ":"",sqlSecurity:e.sqlSecurity?`SQL SECURITY ${e.sqlSecurity} `:"",checkOption:e.checkOption?`
WITH ${e.checkOption} CHECK OPTION`:"",selectStatement:r,algorithm:s});return{deactivatedWholeStatement:t,statement:E}},createView(e,n,t){let{deactivatedWholeStatement:r,selectStatement:s}=this.viewSelectStatement(e,t),E=e.algorithm&&e.algorithm!=="UNDEFINED"?`ALGORITHM ${e.algorithm} `:"";return L(c(T.createView,{name:a(e.name,n.databaseName),orReplace:e.orReplace?"OR REPLACE ":"",ifNotExist:e.ifNotExist?"IF NOT EXISTS ":"",sqlSecurity:e.sqlSecurity?`SQL SECURITY ${e.sqlSecurity} `:"",checkOption:e.checkOption?`
WITH ${e.checkOption} CHECK OPTION`:"",selectStatement:s,algorithm:E}),{isActivated:!r})},createViewIndex(e,n,t,r){return""},createUdt(e,n){return""},getDefaultType(e){return xe[e]},getTypesDescriptors(){return Le},hasType(e){return x(Le,e)},hydrateColumn({columnDefinition:e,jsonSchema:n,dbData:t}){return{name:e.name,type:e.type,primaryKey:q.isInlinePrimaryKey(n),primaryKeyOptions:p.omit(q.hydratePrimaryKeyOptions(n.primaryKeyOptions||{}),"columns"),unique:q.isInlineUnique(n),uniqueKeyOptions:p.omit(q.hydrateUniqueOptions(p.first(n.uniqueKeyOptions)||{}),"columns"),nullable:e.nullable,default:e.default,comment:e.description||n.refDescription||n.description,isActivated:e.isActivated,scale:e.scale,precision:e.precision,length:e.length,national:n.national,zerofill:n.zerofill,invisible:n.invisible,compressionMethod:n.compressed?n.compression_method:"",enum:n.enum,synonym:n.synonym,signed:n.zerofill||n.signed,microSecPrecision:n.microSecPrecision,charset:n.characterSet,collation:n.collation,...Y(e.type)&&{autoIncrement:n.autoincrement}}},hydrateIndex(e,n){return e},hydrateViewIndex(e){return{}},hydrateCheckConstraint(e){return{name:e.chkConstrName,expression:e.constrExpression}},hydrateDatabase(e,n){return{databaseName:e.name,orReplace:e.orReplace,ifNotExist:e.ifNotExist,characterSet:e.characterSet,collation:e.collation,comments:e.description,udfs:((n==null?void 0:n.udfs)||[]).map(this.hydrateUdf),procedures:((n==null?void 0:n.procedures)||[]).map(this.hydrateProcedure)}},hydrateTable({tableData:e,entityData:n,jsonSchema:t}){let r=n[0],s=p.get(e,`relatedSchemas[${r.like}]`,"");return{...e,keyConstraints:q.getTableKeyConstraints({jsonSchema:t}),temporary:r.temporary,orReplace:r.orReplace,ifNotExist:!r.orReplace&&r.ifNotExist,likeTableName:(s==null?void 0:s.code)||(s==null?void 0:s.collectionName),selectStatement:p.trim(r.selectStatement),options:{...r.tableOptions,description:r.description},partitioning:r.partitioning}},hydrateViewColumn(e){return{name:e.name,tableName:e.entityName,alias:e.alias,isActivated:e.isActivated,dbName:e.dbName}},hydrateView({viewData:e,entityData:n,relatedSchemas:t,relatedContainers:r}){let s=n[0];return{name:e.name,tableName:e.tableName,keys:e.keys,orReplace:s.orReplace,ifNotExist:s.ifNotExist,selectStatement:s.selectStatement,sqlSecurity:s.SQL_SECURITY,algorithm:s.algorithm,checkOption:s.withCheckOption?s.checkTestingScope:""}},commentIfDeactivated(e,n,t){return e},hydrateUdf(e){return{name:e.name,delimiter:e.functionDelimiter,orReplace:e.functionOrReplace,aggregate:e.functionAggregate,ifNotExist:e.functionIfNotExist,parameters:e.functionArguments,type:e.functionReturnType,characteristics:{sqlSecurity:e.functionSqlSecurity,language:e.functionLanguage,contains:e.functionContains,deterministic:e.functionDeterministic,comment:e.functionDescription},body:e.functionBody}},hydrateProcedure(e){return{orReplace:e.orReplace,delimiter:e.delimiter,name:e.name,parameters:e.inputArgs,body:e.body,characteristics:{comment:e.comments,contains:e.contains,language:e.language,deterministic:e.deterministic,sqlSecurity:e.securityMode}}},createUdf(e,n){let t=P(n.characteristics),r=n.delimiter?`DELIMITER ${n.delimiter}
`:"",s=n.delimiter?`DELIMITER ;
`:"";return r+c(T.createFunction,{name:a(n.name,e),orReplace:n.orReplace?"OR REPLACE ":"",ifNotExist:n.ifNotExist?"IF NOT EXISTS ":"",aggregate:n.aggregate?"AGGREGATE ":"",characteristics:t.join(`
	`),type:n.type,parameters:n.parameters,body:n.body,delimiter:n.delimiter||";"})+s},createProcedure(e,n){let t=P(n.characteristics),r=n.delimiter?`DELIMITER ${n.delimiter}
`:"",s=n.delimiter?`DELIMITER ;
`:"";return r+c(T.createProcedure,{name:a(n.name,e),orReplace:n.orReplace?"OR REPLACE ":"",parameters:n.parameters,characteristics:t.join(`
	`),body:n.body,delimiter:n.delimiter||";"})+s},dropIndex(e,n,t){let r=a(e,n.databaseName),s=t.name,E=re(s),N={tableName:r,indexName:E};return c(T.dropIndex,N)},viewSelectStatement(e,n=!0){let r=C(e.keys||[])||!n,{columns:s,tables:E}=B(e.keys),N=s.map(I=>I.statement).join(`,
		`);if(!r){let I=K(s,O=>O.statement),g=I.deactivatedItems.length?L(I.deactivatedItems.join(`,
		`),{isActivated:!1,isPartOfLine:!0}):"";N=I.activatedItems.join(`,
		`)+g}let A=p.trim(e.selectStatement)?p.trim(M(e.selectStatement)):c(T.viewSelectStatement,{tableName:E.join(", "),keys:N});return{deactivatedWholeStatement:r,selectStatement:A}},alterView({viewName:e,selectStatement:n,sqlSecurity:t,algorithm:r}){let s={name:e,selectStatement:n,sqlSecurity:t?` ${t}`:"",algorithm:r?` ${r}`:""};return c(T.alterView,s)},dropDatabase(e){let n={databaseName:e};return c(T.dropDatabase,n)},dropProcedure(e){let n={procedureName:e};return c(T.dropProcedure,n)},dropUdf(e){let n={functionName:e};return c(T.dropFunction,n)},alterCollation(e,n,t){let r={databaseName:e,characterSet:n,collation:t};return c(T.alterCollation,r)},dropView(e){let n={viewName:e};return c(T.dropView,n)},dropTable(e){let n={tableName:e};return c(T.dropTable,n)},dropColumn(e,n){let t={tableName:e,columnName:n};return c(T.dropColumn,t)},addColumn(e,n){let t={tableName:e,columnDefinition:n};return c(T.addColumn,t)},renameColumn(e,n,t){let r={tableName:e,oldName:n,newName:t};return c(T.renameColumn,r)},modifyColumn(e,n){let t=V(n),r={tableName:e,columnDefinition:t};return c(T.modifyColumn,r)},modifyTableOptions(e,n){let t=n!=null&&n.defaultCharSet?"DEFAULT ":"",r=n!=null&&n.characterSet?`CHARACTER SET='${n==null?void 0:n.characterSet}' `:"",s=n!=null&&n.collation?`COLLATE='${n==null?void 0:n.collation}'`:"",E={tableName:e,defaultKeyword:t,characterSetDefinition:r,collateDefinition:s};return c(T.modifyTableOptions,E).trim()},updateTableComment(e,n){let t={tableName:e,comment:n};return c(T.updateCommentOnTable,t)},dropTableComment(e){let n={tableName:e,comment:"''"};return c(T.updateCommentOnTable,n)},updateSchemaComment(e,n){let t={schemaName:e,comment:n};return c(T.updateCommentOnSchema,t)},dropSchemaComment(e){let n={schemaName:e,comment:"''"};return c(T.updateCommentOnSchema,n)},dropConstraint(e,n){let t={tableName:e,constraintName:n};return c(T.dropConstraint,t)},addCheckConstraint(e,n,t){let r={tableName:e,constraintName:n,expression:t};return c(T.addCheckConstraint,r)},addPrimaryKey(e,n,t){let r=v(T,n)(t),s={tableName:e,constraintStatement:r.statement};return{statement:c(T.addPkConstraint,s),isActivated:n&&r.isActivated}},dropPrimaryKey(e){let n={tableName:e};return c(T.dropPrimaryKey,n)}}}});module.exports=Me();
