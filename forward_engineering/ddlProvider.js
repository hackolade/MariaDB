"use strict";var Ye=Object.defineProperty;var i=(l,R)=>Ye(l,"name",{value:R,configurable:!0});var U=(l,R)=>()=>(R||l((R={exports:{}}).exports,R),R.exports);var ce=U((qe,se)=>{"use strict";se.exports={number:"NUMBER",string:"TEXT",date:"DATE",timestamp:"TIMESTAMP",binary:"BINARY",boolean:"BIT",document:"LONGTEXT",array:"LONGTEXT",objectId:"VARCHAR(24)",default:"CHAR"}});var Ee=U((Ge,me)=>{"use strict";me.exports={TINYINT:{capacity:1},SMALLINT:{capacity:2},MEDIUMINT:{capacity:3},INT:{capacity:4},INTEGER:{capacity:4},BIGINT:{capacity:8},INT1:{capacity:1},INT2:{capacity:2},INT3:{capacity:3},INT4:{capacity:4},INT8:{capacity:8},FLOAT:{capacity:4,mode:"floating"},DOUBLE:{capacity:8,mode:"floating"},"DOUBLE PRECISION":{capacity:8,mode:"floating"},REAL:{capacity:8,mode:"floating"},DECIMAL:{capacity:16,mode:"decimal"},DEC:{capacity:16,mode:"decimal"},NUMERIC:{capacity:16,mode:"decimal"},FIXED:{capacity:16,mode:"decimal"},NUMBER:{capacity:16,mode:"decimal"},CHAR:{size:1},VARCHAR:{mode:"varying"},TINYTEXT:{size:255,mode:"text"},TEXT:{size:65535,mode:"text"},MEDIUMTEXT:{size:16777215,mode:"text"},LONGTEXT:{size:4294967295,mode:"text"},JSON:{size:4294967295,mode:"text"},BINARY:{mode:"binary"},"CHAR BYTE":{mode:"binary"},VARBINARY:{size:2147483649,mode:"binary"},TINYBLOB:{size:255,mode:"binary"},BLOB:{size:65535,mode:"binary"},MEDIUMBLOB:{size:16777215,mode:"binary"},LONGBLOB:{size:4294967295,mode:"binary"},BIT:{mode:"boolean"},DATE:{format:"YYYY-MM-DD"},TIME:{format:"hh:mm:ss.nnnnnn"},DATETIME:{format:"YYYY-MM-DD hh:mm:ss"},TIMESTAMP:{format:"YYYY-MM-DD hh:mm:ss"},YEAR:{format:"YYYY"},INET6:{mode:"ip"},ENUM:{mode:"enum"},SET:{mode:"enum"},GEOMETRY:{format:"euclidian",mode:"geospatial"},POINT:{format:"euclidian",mode:"geospatial"},LINESTRING:{format:"euclidian",mode:"geospatial"},POLYGON:{format:"euclidian",mode:"geospatial"},MULTIPOINT:{format:"euclidian",mode:"geospatial"},MULTILINESTRING:{format:"euclidian",mode:"geospatial"},MULTIPOLYGON:{format:"euclidian",mode:"geospatial"},GEOMETRYCOLLECTION:{format:"euclidian",mode:"geospatial"}}});var Te=U((He,le)=>{"use strict";le.exports={createDatabase:"CREATE${orReplace} DATABASE${ifNotExist} `${name}`${dbOptions};\n\n${useDb}",createTable:"CREATE ${orReplace}${temporary}TABLE ${ifNotExist}${name} (\n	${column_definitions}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n)${options}${partitions}${selectStatement};\n",createLikeTable:"CREATE ${orReplace}${temporary}TABLE ${ifNotExist}${name} LIKE ${likeTableName};\n",columnDefinition:"`${name}` ${national}${type}${signed}${primary_key}${unique_key}${default}${autoIncrement}${zeroFill}${not_null}${invisible}${compressed}${charset}${collate}${comment}",checkConstraint:"CONSTRAINT ${name}CHECK (${expression})",createForeignKeyConstraint:"CONSTRAINT `${name}` FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey})",createKeyConstraint:"${constraintName}${keyType}${columns}${using}${blockSize}${comment}${ignore}",createForeignKey:"ALTER TABLE ${foreignTable} ADD CONSTRAINT `${name}` FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey});",addCheckConstraint:"ALTER TABLE ${tableName} ADD CONSTRAINT ${constraintName} CHECK (${expression});",addPkConstraint:"ALTER TABLE ${tableName} ADD ${constraintStatement};",dropPrimaryKey:"ALTER TABLE ${tableName} DROP PRIMARY KEY;",dropConstraint:"ALTER TABLE ${tableName} DROP CONSTRAINT ${constraintName};",dropDatabase:"DROP DATABASE IF EXISTS ${databaseName};",dropProcedure:"DROP PROCEDURE IF EXISTS ${procedureName};",dropFunction:"DROP FUNCTION IF EXISTS ${functionName};",updateCommentOnTable:"ALTER TABLE ${tableName} COMMENT ${comment};",updateCommentOnSchema:"ALTER SCHEMA ${schemaName} COMMENT = ${comment};",alterCollation:"ALTER DATABASE ${databaseName} CHARACTER SET=${characterSet} COLLATE=${collation};",dropTable:"DROP TABLE IF EXISTS ${tableName};",dropColumn:"ALTER TABLE IF EXISTS ${tableName} DROP COLUMN IF EXISTS ${columnName};",addColumn:"ALTER TABLE IF EXISTS ${tableName} ADD COLUMN IF NOT EXISTS ${columnDefinition};",modifyColumn:"ALTER TABLE ${tableName} MODIFY COLUMN IF EXISTS ${columnDefinition};",dropView:"DROP VIEW IF EXISTS ${viewName};",renameColumn:"ALTER TABLE IF EXISTS ${tableName} RENAME COLUMN ${oldName} TO ${newName};",modifyTableOptions:"ALTER TABLE ${tableName} ${defaultKeyword}${characterSetDefinition}${collateDefinition};",index:"CREATE ${indexType}INDEX ${ifNotExist}${name}${indexCategory}\n	ON ${table} ( ${keys} )${indexOptions};\n",dropIndex:"ALTER TABLE ${tableName} DROP INDEX IF EXISTS ${indexName};",createView:"CREATE ${orReplace}${algorithm}${sqlSecurity}VIEW ${ifNotExist}${name} AS ${selectStatement}${checkOption};\n",viewSelectStatement:"SELECT ${keys}\n	FROM ${tableName}",createFunction:"CREATE ${orReplace}${aggregate}FUNCTION ${ifNotExist}${name}\n	(${parameters})\n	RETURNS ${type}\n	${characteristics}\n${body}${delimiter}\n",createProcedure:"CREATE ${orReplace}PROCEDURE ${name} (${parameters})\n	${characteristics}\n${body}${delimiter}\n",alterView:"ALTER VIEW ${name}${algorithm}${sqlSecurity} AS ${selectStatement}"}});var Z=U((ve,ue)=>{"use strict";var Q=class Q{name;type;primaryKey;primaryKeyOptions;unique;uniqueKeyOptions;nullable;default;comment;isActivated;scale;precision;length;national;autoIncrement;zerofill;invisible;compressionMethod;enum;synonym;signed;microSecPrecision;charset;collation};i(Q,"HydratedColumn");var w=Q;ue.exports={HydratedColumn:w}});var ee=U((We,Ne)=>{"use strict";var j=class j{name;type;nullable;primaryKey;default;length;scale;precision;hasMaxLength;isActivated;unique;zerofill;autoIncrement;invisible;national;comment;charset;compressionMethod;signed;microSecPrecision;enum};i(j,"ColumnDefinition");var J=j;Ne.exports={ColumnDefinition:J}});var re=U((ke,Ie)=>{"use strict";var ne=class ne{name;isActivated};i(ne,"KeyJsonSchema");var te=ne;Ie.exports={KeyJsonSchema:te}});var de=U((Ze,pe)=>{"use strict";var{ColumnDefinition:we}=ee(),{HydratedColumn:Qe}=Z();pe.exports=(l,R)=>{let K=i((o,u)=>`${o}(${u})`,"addLength"),d=i((o,u,f)=>l.isNumber(f)?`${o}(${u},${f})`:`${o}(${u})`,"addScalePrecision"),P=i((o,u)=>`${o}(${u})`,"addPrecision"),M=i(o=>["CHAR","VARCHAR","BINARY","CHAR BYTE","VARBINARY","BLOB"].includes(o),"canHaveLength"),y=i(o=>["TINYINT","SMALLINT","MEDIUMINT","INT","INTEGER","BIGINT","INT1","INT2","INT3","INT4","INT8","FLOAT","DOUBLE","REAL","DECIMAL","DEC","NUMERIC","FIXED","NUMBER","DOUBLE PRECISION","BIT"].includes(o),"isNumeric"),b=i(o=>y(o),"canHavePrecision"),h=i(o=>["TIME","DATETIME","TIMESTAMP"].includes(o),"canHaveMicrosecondPrecision"),D=i(o=>["DECIMAL","FLOAT","DOUBLE","DEC","FIXED","NUMERIC","NUMBER","DOUBLE PRECISION","REAL"].includes(o),"canHaveScale"),B=i((o,u)=>M(o)&&l.isNumber(u.length)?K(o,u.length):b(o)&&D(o)&&l.isNumber(u.precision)?d(o,u.precision,u.scale):b(o)&&l.isNumber(u.precision)?P(o,u.precision):h(o)&&l.isNumber(u.microSecPrecision)?P(o,u.microSecPrecision):["ENUM","SET"].includes(o)&&!l.isEmpty(u.enum)?`${o}('${u.enum.join("', '")}')`:o,"decorateType"),c=i(o=>["CHAR","VARCHAR","TEXT","TINYTEXT","MEDIUMTEXT","LONGTEXT"].includes(l.toUpper(o)),"isString"),O=i(o=>["TIME","DATE","DATETIME","TIMESTAMP"].includes(o),"isDateTime"),N=i(o=>l.trim(o).replace(/(')+/g,"'$1"),"escapeQuotes");return{decorateType:B,decorateDefault:i((o,u)=>{let f=["current_timestamp","null"];return(c(o)||O(o))&&!f.includes(l.toLower(u))?R(N(u)):u},"decorateDefault"),canBeNational:i(o=>["CHAR","VARCHAR"].includes(o),"canBeNational"),isNumeric:y,getSign:i((o,u)=>y(o)&&u===!1?" UNSIGNED":"","getSign"),canHaveAutoIncrement:i(o=>["tinyint","smallint","mediumint","int","bigint"].includes(o),"canHaveAutoIncrement")}}});var Se=U((je,Ae)=>{"use strict";var Ue=Object.freeze({ENGINE:"ENGINE",AUTO_INCREMENT:"AUTO_INCREMENT",AVG_ROW_LENGTH:"AVG_ROW_LENGTH",CHECKSUM:"CHECKSUM",DATA_DIRECTORY:"DATA DIRECTORY",DELAY_KEY_WRITE:"DELAY_KEY_WRITE",INDEX_DIRECTORY:"INDEX DIRECTORY",ENCRYPTED:"ENCRYPTED",ENCRYPTION_KEY_ID:"ENCRYPTION_KEY_ID",IETF_QUOTES:"IETF_QUOTES",INSERT_METHOD:"INSERT_METHOD",UNION:"UNION",KEY_BLOCK_SIZE:"KEY_BLOCK_SIZE",MIN_ROWS:"MIN_ROWS",MAX_ROWS:"MAX_ROWS",PACK_KEYS:"PACK_KEYS",PAGE_CHECKSUM:"PAGE_CHECKSUM",PAGE_COMPRESSED:"PAGE_COMPRESSED",PAGE_COMPRESSION_LEVEL:"PAGE_COMPRESSION_LEVEL",ROW_FORMAT:"ROW_FORMAT",SEQUENCE:"SEQUENCE",STATS_AUTO_RECALC:"STATS_AUTO_RECALC",STATS_PERSISTENT:"STATS_PERSISTENT",TRANSACTIONAL:"TRANSACTIONAL",WITH_SYSTEM_VERSIONING:"WITH SYSTEM VERSIONING"}),he=Object.freeze({MyISAM:["AUTO_INCREMENT","AVG_ROW_LENGTH","CHECKSUM","DATA_DIRECTORY","DELAY_KEY_WRITE","INDEX_DIRECTORY","KEY_BLOCK_SIZE","PACK_KEYS","ROW_FORMAT","WITH_SYSTEM_VERSIONING"],InnoDB:["AUTO_INCREMENT","DATA_DIRECTORY","INDEX_DIRECTORY","ENCRYPTED","ENCRYPTION_KEY_ID","KEY_BLOCK_SIZE","PACK_KEYS","PAGE_COMPRESSED","PAGE_COMPRESSION_LEVEL","ROW_FORMAT","SEQUENCE","STATS_AUTO_RECALC","STATS_PERSISTENT","WITH_SYSTEM_VERSIONING"],CSV:["IETF_QUOTES","KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"],MERGE:["INSERT_METHOD","UNION","KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"],Aria:["AUTO_INCREMENT","AVG_ROW_LENGTH","CHECKSUM","DATA_DIRECTORY","DELAY_KEY_WRITE","INDEX_DIRECTORY","PAGE_CHECKSUM","ROW_FORMAT","KEY_BLOCK_SIZE","PACK_KEYS","TRANSACTIONAL","WITH_SYSTEM_VERSIONING"],Memory:["AUTO_INCREMENT","KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"],Archive:["AUTO_INCREMENT","KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"]});Ae.exports={TableOptions:Ue,TableOptionsByEngine:he}});var ye=U((et,Ce)=>{"use strict";var{TableOptionsByEngine:Be,TableOptions:Re}=Se();Ce.exports=({_:l,wrap:R})=>{let K=i((t,r)=>r?`\`${r}\`.\`${t}\``:`\`${t}\``,"getNamePrefixedWithSchemaName"),d=i((t,r)=>K(t,r),"getTableName"),P=i((t,r)=>K(t,r),"getProcedureName"),M=i((t,r)=>K(t,r),"getUdfName"),y=i(t=>`\`${t}\``,"wrapDbName"),b=i((t,r)=>{if(["ROW_FORMAT","INSERT_METHOD"].includes(t))return r?l.toUpper(r):void 0;if(t==="UNION")return r;if(["YES","NO","DEFAULT"].includes(l.toUpper(r)))return l.toUpper(r);if(typeof r=="number")return r;if(!isNaN(+r)&&r)return+r;if(typeof r=="string"&&r)return R(r);if(typeof r=="boolean")return r?"YES":"NO"},"getOptionValue"),h=i((t="")=>t.replace(/(?<!\\)('|"|`)/gi,"\\$1").replace(/\n/gi,"\\n"),"encodeStringLiteral"),D=i((t={})=>{let r=[],a=t.ENGINE;return t.defaultCharSet||(t.characterSet&&r.push(`CHARSET=${t.characterSet}`),t.collation&&r.push(`COLLATE=${t.collation}`)),a&&r.push(`ENGINE = ${a}`),t.description&&r.push(`COMMENT = '${h(t.description)}'`),(Be[a]||["KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"]).forEach(I=>{if(I==="WITH_SYSTEM_VERSIONING")return t[I]?r.push(Re[I]):void 0;let S=b(I,t[I]);if(S===void 0)return;let p=`${Re[I]} = ${S}`;r.push(p)}),r.length?" "+r.join(`,
	`):""},"getTableOptions"),B=i(t=>t?"LINEAR ":"","addLinear"),c=i(t=>{if(t.partitionType==="SYSTEM_TIME"){let r=!isNaN(t.interval)&&t.interval?` INTERVAL ${t.interval}`:"";return r&&t.time_unit&&(r+=` ${t.time_unit}`),`SYSTEM_TIME${r}`}return`${B(t.LINEAR)}${t.partitionType}(${l.trim(t.partitioning_expression)})`},"getPartitionBy"),O=i(t=>t.subpartitionType?`SUBPARTITION BY ${B(t.SUBLINEAR)}${t.subpartitionType}(${l.trim(t.subpartitioning_expression)})`:"","getSubPartitionBy"),N=i(t=>{if(!Array.isArray(t.partition_definitions))return"";let r=t.partition_definitions.filter(({partitionDefinition:a})=>a).map(a=>{let E=a.subpartitionDefinition;return E?a.partitionDefinition+" "+R(E,"(",")"):a.partitionDefinition}).join(`,
		`);return r?R(`
		`+r+`
	`,"(",")"):""},"getPartitionDefinitions"),$=i((t={})=>{if(!t.partitionType)return"";let r=`PARTITION BY ${c(t)}`,a=t.partitions?`PARTITIONS ${t.partitions}`:"",E=O(t),I=t.subpartitions?`SUBPARTITIONS ${t.subpartitions}`:"",S=N(t),p=[r,a,E,I,S].filter(Boolean);return p.length?`
	`+p.join(`
	`):""},"getPartitions"),A=i(t=>t?t.alias?`\`${t.name}\` as \`${t.alias}\``:`\`${t.name}\``:"","getKeyWithAlias"),s=i(t=>Array.isArray(t)?t.reduce((r,a)=>{if(!a.tableName)return r.columns.push(A(a)),r;let E=`\`${a.dbName}\`.\`${a.tableName}\``;return r.tables.includes(E)||r.tables.push(E),r.columns.push({statement:`${E}.${A(a)}`,isActivated:a.isActivated}),r},{tables:[],columns:[]}):{tables:[],columns:[]},"getViewData"),m=i(t=>{let r=[];return t.language&&r.push("LANGUAGE SQL"),t.deterministic&&r.push(t.deterministic),t.sqlSecurity&&r.push(`SQL SECURITY ${t.sqlSecurity}`),t.comment&&r.push(`COMMENT ${R(o(t.comment))}`),r},"getCharacteristics"),o=i((t="")=>t.replace(/(')/gi,"'$1").replace(/\n/gi,"\\n"),"escapeQuotes");return{getTableName:d,getCollectionName:i(t=>(t==null?void 0:t.code)||(t==null?void 0:t.collectionName)||(t==null?void 0:t.name),"getCollectionName"),getCollectionSchema:i(t=>({...t,...l.omit(t==null?void 0:t.role,"properties")||{}}),"getCollectionSchema"),getDatabaseName:i(t=>{var r;return(r=t.compMod)==null?void 0:r.keyspaceName},"getDatabaseName"),wrapDbName:y,getContainerName:i(t=>t.code||t.name||t.collectionName,"getContainerName"),getModifiedGroupItemsByName:i((t=[],r=[])=>{let a=t.filter(S=>!r.some(p=>p.name===S.name)),E=[],I=[];for(let S of r){let p=t.find(g=>g.name===S.name);if(!p){E.push(S);continue}!l.isEqual(p,S)&&I.push(p)}return{added:a,removed:E,modified:I}},"getModifiedGroupItemsByName"),getProcedureName:P,getUdfName:M,getTableOptions:D,getPartitions:$,getViewData:s,getCharacteristics:m,escapeQuotes:o,checkFieldPropertiesChanged:i((t,r)=>r.some(a=>(t==null?void 0:t.oldField[a])!==(t==null?void 0:t.newField[a])),"checkFieldPropertiesChanged"),getCompMod:i(t=>{var r;return((r=t.role)==null?void 0:r.compMod)??{}},"getCompMod"),checkCompModEqual:i(({new:t,old:r}={},a)=>a.isEqual(t,r),"checkCompModEqual"),getViewSchema:i(t=>({...t,...t.role??{}}),"getViewSchema"),getViewName:i(t=>t.code||t.name,"getViewName"),wrapInTics:i(t=>`\`${t}\``,"wrapInTics"),wrapInSingleQuotes:i(t=>`'${t}'`,"wrapInSingleQuotes"),commentIfDeactivated:i((t,{isActivated:r,isPartOfLine:a,inlineComment:E="--"})=>t?r!==!1?t:a?"/* "+t+" */":t.includes(`
`)?`/*
`+t+` */
`:E+" "+t:"","commentIfDeactivated"),getNamePrefixedWithSchemaName:K}}});var fe=U((rt,Oe)=>{"use strict";var{KeyJsonSchema:nt}=re();Oe.exports=({_:l,commentIfDeactivated:R,checkAllKeysDeactivated:K,divideIntoActivatedAndDeactivated:d,assignTemplates:P,escapeQuotes:M})=>{let y=i((c,O)=>{var s,m;let N=R(((c==null?void 0:c.deactivatedItems)||[]).join(`,
	`),{isActivated:!O,isPartOfLine:!0}),$=(s=c==null?void 0:c.activatedItems)!=null&&s.length?`,
	`+c.activatedItems.join(`,
	`):"",A=(m=c==null?void 0:c.deactivatedItems)!=null&&m.length?`
	`+N:"";return $+A},"generateConstraintsString"),b=i(c=>{if(Array.isArray(c)){let O=c.filter(A=>l.get(A,"isActivated",!0)).map(A=>`\`${l.trim(A.name)}\``),N=c.filter(A=>!l.get(A,"isActivated",!0)).map(A=>`\`${l.trim(A.name)}\``),$=N.length?R(N,{isActivated:!1,isPartOfLine:!0}):"";return O.join(", ")+$}return c},"foreignKeysToString"),h=i(c=>c.map(O=>l.trim(O.name)).join(", "),"foreignActiveKeysToString"),D=i((c,O)=>N=>{let $=K(N.columns||[]),A=B($,O,N.columns),s=N.category?` USING ${N.category}`:"",m=N.ignore?" IGNORED":"",o=N.comment?` COMMENT '${M(N.comment)}'`:"",u=N.blockSize?` KEY_BLOCK_SIZE=${N.blockSize}`:"";return{statement:P(c.createKeyConstraint,{constraintName:N.name?`CONSTRAINT \`${l.trim(N.name)}\` `:"",keyType:N.keyType,blockSize:u,columns:A,comment:o,ignore:m,using:s}),isActivated:!$}},"createKeyConstraint"),B=i((c,O,N)=>{var m;if(!N)return"";let $=i(({name:o,order:u})=>`\`${o}\` ${u}`.trim(),"columnMapToString"),A=d(N,$),s=(m=A==null?void 0:A.deactivatedItems)!=null&&m.length?R(A.deactivatedItems.join(", "),{isActivated:!1,isPartOfLine:!0}):"";return!c&&O?" ("+A.activatedItems.join(", ")+s+")":" ("+N.map($).join(", ")+")"},"getKeyColumns");return{generateConstraintsString:y,foreignKeysToString:b,foreignActiveKeysToString:h,createKeyConstraint:D}}});var $e=U((at,ge)=>{"use strict";ge.exports=(l,R)=>{let K=i((s,m)=>Object.entries(s.properties).map(m),"mapProperties"),d=i(s=>s.compositeUniqueKey?!1:s.unique,"isUniqueKey"),P=i(s=>{var m,o;return d(s)&&(((m=s.uniqueKeyOptions)==null?void 0:m.length)===1&&!((o=l.first(s.uniqueKeyOptions))!=null&&o.constraintName)||l.isEmpty(s.uniqueKeyOptions))},"isInlineUnique"),M=i(s=>s.compositeUniqueKey||s.compositePrimaryKey?!1:s.primaryKey,"isPrimaryKey"),y=i(s=>{var m;return M(s)&&!((m=s.primaryKeyOptions)!=null&&m.constraintName)},"isInlinePrimaryKey"),b=i(s=>l.toLower(s)==="asc"?"ASC":l.toLower(s)==="desc"?"DESC":"","getOrder"),h=i((s,m,o)=>R({keyType:"UNIQUE",name:s.constraintName,columns:[{name:m,order:b(s.order),isActivated:o}],category:s.indexCategory,ignore:s.indexIgnore,comment:s.indexComment,blockSize:s.indexBlockSize}),"hydrateUniqueOptions"),D=i((s,m,o)=>R({keyType:"PRIMARY KEY",name:s.constraintName,columns:[{name:m,order:b(s.order),isActivated:o}],category:s.indexCategory,ignore:s.indexIgnore,comment:s.indexComment,blockSize:s.indexBlockSize}),"hydratePrimaryKeyOptions"),B=i((s,m)=>Object.keys(m).find(o=>m[o].GUID===s),"findName"),c=i((s,m)=>l.get(Object.values(m).find(o=>o.GUID===s),"isActivated",!0),"checkIfActivated"),O=i((s,m)=>s.map(o=>({name:B(o.keyId,m.properties),order:o.type==="descending"?"DESC":"ASC",isActivated:c(o.keyId,m.properties)})),"getKeys"),N=i(s=>Array.isArray(s.primaryKey)?s.primaryKey.filter(m=>!l.isEmpty(m.compositePrimaryKey)).map(m=>({...D(m),columns:O(m.compositePrimaryKey,s)})):[],"getCompositePrimaryKeys"),$=i(s=>Array.isArray(s.uniqueKey)?s.uniqueKey.filter(m=>!l.isEmpty(m.compositeUniqueKey)).map(m=>({...h(m),columns:O(m.compositeUniqueKey,s)})):[],"getCompositeUniqueKeys");return{getTableKeyConstraints:i(({jsonSchema:s})=>{if(!s.properties)return[];let m=K(s,([u,f])=>{if(!(!M(f)||y(f)))return D(f.primaryKeyOptions,u,f.isActivated)}).filter(Boolean),o=l.flatten(K(s,([u,f])=>!d(f)||P(f)?[]:(f.uniqueKeyOptions||[]).map(q=>h(q,u,f.isActivated)))).filter(Boolean);return[...m,...N(s),...o,...$(s)]},"getTableKeyConstraints"),isInlineUnique:P,isInlinePrimaryKey:y,hydratePrimaryKeyOptions:D,hydrateUniqueOptions:h}}});var Me=U((Et,Ke)=>{"use strict";var xe=ce(),Le=Ee(),T=Te(),{HydratedColumn:st}=Z(),{ColumnDefinition:ct}=ee(),{KeyJsonSchema:mt}=re();Ke.exports=(l,R,K)=>{let d=K.require("lodash"),{tab:P,commentIfDeactivated:M,checkAllKeysDeactivated:y,divideIntoActivatedAndDeactivated:b,hasType:h,wrap:D,clean:B}=K.require("@hackolade/ddl-fe-utils").general,{assignTemplates:c}=K.require("@hackolade/ddl-fe-utils"),{decorateDefault:O,decorateType:N,canBeNational:$,getSign:A,canHaveAutoIncrement:s}=de()(d,D),{getTableName:m,getTableOptions:o,getPartitions:u,getViewData:f,getCharacteristics:q,escapeQuotes:G,wrapInTics:ie}=ye()({_:d,wrap:D}),{generateConstraintsString:X,foreignKeysToString:H,foreignActiveKeysToString:k,createKeyConstraint:v}=fe()({_:d,commentIfDeactivated:M,checkAllKeysDeactivated:y,divideIntoActivatedAndDeactivated:b,assignTemplates:c,escapeQuotes:G}),F=$e()(d,B),W=i(e=>{let n=d.toUpper(e.type),t=e.nullable?"":" NOT NULL",r=e.primaryKey?" "+v(T,!0)(e.primaryKeyOptions).statement:"",a=e.unique?" "+v(T,!0)(e.uniqueKeyOptions).statement:"",E=e.zerofill?" ZEROFILL":"",I=e.autoIncrement?" AUTO_INCREMENT":"",S=e.invisible?" INVISIBLE":"",p=e.national&&$(n)?"NATIONAL ":"",L=e.comment?` COMMENT '${G(e.comment)}'`:"",g=n!=="JSON"&&e.charset?` CHARSET ${e.charset}`:"",C=n!=="JSON"&&e.charset&&e.collation?` COLLATE ${e.collation}`:"",Y=d.isUndefined(e.default)?"":" DEFAULT "+O(n,e.default),_=e.compressionMethod?` COMPRESSED=${e.compressionMethod}`:"",x=A(n,e.signed);return c(T.columnDefinition,{name:e.name,type:N(n,e),not_null:t,primary_key:r,unique_key:a,default:Y,autoIncrement:I,compressed:_,signed:x,zeroFill:E,invisible:S,comment:L,national:p,charset:g,collate:C})},"mapColumnToColumnDefinitionDdl");return{createDatabase({databaseName:e,orReplace:n,ifNotExist:t,collation:r,characterSet:a,comments:E,udfs:I,procedures:S,useDb:p=!0}){let L="";L+=a?P(`
CHARACTER SET = '${a}'`):"",L+=r?P(`
COLLATE = '${r}'`):"",L+=E?P(`
COMMENT = '${G(E)}'`):"";let g=c(T.createDatabase,{name:e,orReplace:n&&!t?" OR REPLACE":"",ifNotExist:t?" IF NOT EXISTS":"",dbOptions:L,useDb:p?`USE \`${e}\`;
`:""}),C=I.map(_=>this.createUdf(e,_)),Y=S.map(_=>this.createProcedure(e,_));return[g,...C,...Y].join(`
`)},createTable({name:e,columns:n,dbData:t,temporary:r,orReplace:a,ifNotExist:E,likeTableName:I,selectStatement:S,options:p,partitioning:L,checkConstraints:g,foreignKeyConstraints:C,keyConstraints:Y},_){let x=m(e,t.databaseName),V=a?"OR REPLACE ":"",ae=r?"TEMPORARY ":"",oe=E?"IF NOT EXISTS ":"";if(I)return c(T.createLikeTable,{name:x,likeTableName:m(I,t.databaseName),orReplace:V,temporary:ae,ifNotExist:oe});let be=b(Y.map(v(T,_)),z=>z.statement),Pe=X(be,_),De=b(C,z=>z.statement),_e=X(De,_);return c(T.createTable,{name:x,column_definitions:n.join(`,
	`),selectStatement:S?` ${S}`:"",orReplace:V,temporary:ae,ifNotExist:oe,options:o(p),partitions:u(L),checkConstraints:g.length?`,
	`+g.join(`,
	`):"",foreignKeyConstraints:_e,keyConstraints:Pe})},mapColumnToColumnDefinitionDdl:W,convertColumnDefinition(e){let n=W(e),t={isActivated:e.isActivated};return M(n,t)},createIndex(e,n,t,r=!0){if(d.isEmpty(n.indxKey)||!n.indxName)return"";let a=y(n.indxKey||[]),E=n.isActivated===!1||!r||a,I=n.indexType?`${d.toUpper(n.indexType)} `:"",S=n.ifNotExist?"IF NOT EXISTS ":"",p=D(n.indxName||"","`","`"),L=m(e,t.databaseName),g=n.indexCategory?` USING ${n.indexCategory}`:"",C=[],Y=b(n.indxKey||[],V=>`\`${V.name}\`${V.type==="DESC"?" DESC":""}`),_=Y.deactivatedItems.length?M(Y.deactivatedItems.join(", "),{isActivated:E,isPartOfLine:!0}):"";d.toLower(n.waitNoWait)==="wait"&&n.waitValue&&C.push(`WAIT ${n.waitValue}`),d.toLower(n.waitNoWait)==="nowait"&&C.push("NOWAIT"),n.indexComment&&C.push(`COMMENT '${G(n.indexComment)}'`),n.indexLock?C.push(`LOCK ${n.indexLock}`):n.indexAlgorithm&&C.push(`ALGORITHM ${n.indexAlgorithm}`);let x=c(T.index,{keys:Y.activatedItems.join(", ")+(E&&_&&Y.activatedItems.length?", "+_:_),indexOptions:C.length?`
	`+C.join(`
	`):"",name:p,table:L,indexType:I,ifNotExist:S,indexCategory:g});return E?M(x,{isActivated:!1}):x},createCheckConstraint(e){return c(T.checkConstraint,{name:e.name?`${D(e.name,"`","`")} `:"",expression:d.trim(e.expression).replace(/^\(([\s\S]*)\)$/,"$1")})},createForeignKeyConstraint({name:e,foreignKey:n,primaryTable:t,primaryKey:r,primaryTableActivated:a,foreignTableActivated:E,primarySchemaName:I},S,p){let L=y(r),g=y(n),C=!L&&!g&&a&&E;return{statement:c(T.createForeignKeyConstraint,{primaryTable:m(t,I||p.schemaName),name:e,foreignKey:C?H(n):k(n),primaryKey:C?H(r):k(r)}),isActivated:C}},createForeignKey({name:e,foreignTable:n,foreignKey:t,primaryTable:r,primaryKey:a,primaryTableActivated:E,foreignTableActivated:I,foreignSchemaName:S,primarySchemaName:p},L,g){let C=y(a),Y=y(t);return{statement:c(T.createForeignKey,{primaryTable:m(r,p||g.schemaName),foreignTable:m(n,S||g.schemaName),name:e,foreignKey:H(t),primaryKey:H(a)}),isActivated:!C&&!Y&&E&&I}},createViewForAlterScript(e,n){let{deactivatedWholeStatement:t,selectStatement:r}=this.viewSelectStatement(e),a=e.algorithm&&e.algorithm!=="UNDEFINED"?`ALGORITHM ${e.algorithm} `:"",E=c(T.createView,{name:m(e.name,n),orReplace:e.orReplace?"OR REPLACE ":"",ifNotExist:e.ifNotExist?"IF NOT EXISTS ":"",sqlSecurity:e.sqlSecurity?`SQL SECURITY ${e.sqlSecurity} `:"",checkOption:e.checkOption?`
WITH ${e.checkOption} CHECK OPTION`:"",selectStatement:r,algorithm:a});return{deactivatedWholeStatement:t,statement:E}},createView(e,n,t){let{deactivatedWholeStatement:r,selectStatement:a}=this.viewSelectStatement(e,t),E=e.algorithm&&e.algorithm!=="UNDEFINED"?`ALGORITHM ${e.algorithm} `:"";return M(c(T.createView,{name:m(e.name,n.databaseName),orReplace:e.orReplace?"OR REPLACE ":"",ifNotExist:e.ifNotExist?"IF NOT EXISTS ":"",sqlSecurity:e.sqlSecurity?`SQL SECURITY ${e.sqlSecurity} `:"",checkOption:e.checkOption?`
WITH ${e.checkOption} CHECK OPTION`:"",selectStatement:a,algorithm:E}),{isActivated:!r})},createViewIndex(e,n,t,r){return""},createUdt(e,n){return""},getDefaultType(e){return xe[e]},getTypesDescriptors(){return Le},hasType(e){return h(Le,e)},hydrateColumn({columnDefinition:e,jsonSchema:n,dbData:t}){return{name:e.name,type:e.type,primaryKey:F.isInlinePrimaryKey(n),primaryKeyOptions:d.omit(F.hydratePrimaryKeyOptions(n.primaryKeyOptions||{}),"columns"),unique:F.isInlineUnique(n),uniqueKeyOptions:d.omit(F.hydrateUniqueOptions(d.first(n.uniqueKeyOptions)||{}),"columns"),nullable:e.nullable,default:e.default,comment:e.description||n.refDescription||n.description,isActivated:e.isActivated,scale:e.scale,precision:e.precision,length:e.length,national:n.national,zerofill:n.zerofill,invisible:n.invisible,compressionMethod:n.compressed?n.compression_method:"",enum:n.enum,synonym:n.synonym,signed:n.zerofill||n.signed,microSecPrecision:n.microSecPrecision,charset:n.characterSet,collation:n.collation,...s(e.type)&&{autoIncrement:n.autoincrement}}},hydrateIndex(e,n){return e},hydrateViewIndex(e){return{}},hydrateCheckConstraint(e){return{name:e.chkConstrName,expression:e.constrExpression}},hydrateDatabase(e,n){return{databaseName:e.name,orReplace:e.orReplace,ifNotExist:e.ifNotExist,characterSet:e.characterSet,collation:e.collation,comments:e.description,udfs:((n==null?void 0:n.udfs)||[]).map(this.hydrateUdf),procedures:((n==null?void 0:n.procedures)||[]).map(this.hydrateProcedure)}},hydrateTable({tableData:e,entityData:n,jsonSchema:t}){let r=n[0],a=d.get(e,`relatedSchemas[${r.like}]`,"");return{...e,keyConstraints:F.getTableKeyConstraints({jsonSchema:t}),temporary:r.temporary,orReplace:r.orReplace,ifNotExist:!r.orReplace&&r.ifNotExist,likeTableName:(a==null?void 0:a.code)||(a==null?void 0:a.collectionName),selectStatement:d.trim(r.selectStatement),options:{...r.tableOptions,description:r.description},partitioning:r.partitioning}},hydrateViewColumn(e){return{name:e.name,tableName:e.entityName,alias:e.alias,isActivated:e.isActivated,dbName:e.dbName}},hydrateView({viewData:e,entityData:n,relatedSchemas:t,relatedContainers:r}){let a=n[0];return{name:e.name,tableName:e.tableName,keys:e.keys,orReplace:a.orReplace,ifNotExist:a.ifNotExist,selectStatement:a.selectStatement,sqlSecurity:a.SQL_SECURITY,algorithm:a.algorithm,checkOption:a.withCheckOption?a.checkTestingScope:""}},commentIfDeactivated(e,n,t){return e},hydrateUdf(e){return{name:e.name,delimiter:e.functionDelimiter,orReplace:e.functionOrReplace,aggregate:e.functionAggregate,ifNotExist:e.functionIfNotExist,parameters:e.functionArguments,type:e.functionReturnType,characteristics:{sqlSecurity:e.functionSqlSecurity,language:e.functionLanguage,contains:e.functionContains,deterministic:e.functionDeterministic,comment:e.functionDescription},body:e.functionBody}},hydrateProcedure(e){return{orReplace:e.orReplace,delimiter:e.delimiter,name:e.name,parameters:e.inputArgs,body:e.body,characteristics:{comment:e.comments,contains:e.contains,language:e.language,deterministic:e.deterministic,sqlSecurity:e.securityMode}}},createUdf(e,n){let t=q(n.characteristics),r=n.delimiter?`DELIMITER ${n.delimiter}
`:"",a=n.delimiter?`DELIMITER ;
`:"";return r+c(T.createFunction,{name:m(n.name,e),orReplace:n.orReplace?"OR REPLACE ":"",ifNotExist:n.ifNotExist?"IF NOT EXISTS ":"",aggregate:n.aggregate?"AGGREGATE ":"",characteristics:t.join(`
	`),type:n.type,parameters:n.parameters,body:n.body,delimiter:n.delimiter||";"})+a},createProcedure(e,n){let t=q(n.characteristics),r=n.delimiter?`DELIMITER ${n.delimiter}
`:"",a=n.delimiter?`DELIMITER ;
`:"";return r+c(T.createProcedure,{name:m(n.name,e),orReplace:n.orReplace?"OR REPLACE ":"",parameters:n.parameters,characteristics:t.join(`
	`),body:n.body,delimiter:n.delimiter||";"})+a},dropIndex(e,n,t){let r=m(e,n.databaseName),a=t.name,E=ie(a),I={tableName:r,indexName:E};return c(T.dropIndex,I)},viewSelectStatement(e,n=!0){let r=y(e.keys||[])||!n,{columns:a,tables:E}=f(e.keys),I=a.map(p=>p.statement).join(`,
		`);if(!r){let p=b(a,g=>g.statement),L=p.deactivatedItems.length?M(p.deactivatedItems.join(`,
		`),{isActivated:!1,isPartOfLine:!0}):"";I=p.activatedItems.join(`,
		`)+L}let S=d.trim(e.selectStatement)?d.trim(P(e.selectStatement)):c(T.viewSelectStatement,{tableName:E.join(", "),keys:I});return{deactivatedWholeStatement:r,selectStatement:S}},alterView({viewName:e,selectStatement:n,sqlSecurity:t,algorithm:r}){let a={name:e,selectStatement:n,sqlSecurity:t?` ${t}`:"",algorithm:r?` ${r}`:""};return c(T.alterView,a)},dropDatabase(e){let n={databaseName:e};return c(T.dropDatabase,n)},dropProcedure(e){let n={procedureName:e};return c(T.dropProcedure,n)},dropUdf(e){let n={functionName:e};return c(T.dropFunction,n)},alterCollation(e,n,t){let r={databaseName:e,characterSet:n,collation:t};return c(T.alterCollation,r)},dropView(e){let n={viewName:e};return c(T.dropView,n)},dropTable(e){let n={tableName:e};return c(T.dropTable,n)},dropColumn(e,n){let t={tableName:e,columnName:n};return c(T.dropColumn,t)},addColumn(e,n){let t={tableName:e,columnDefinition:n};return c(T.addColumn,t)},renameColumn(e,n,t){let r={tableName:e,oldName:n,newName:t};return c(T.renameColumn,r)},modifyColumn(e,n){let t=W(n),r={tableName:e,columnDefinition:t};return c(T.modifyColumn,r)},modifyTableOptions(e,n){let t=n!=null&&n.defaultCharSet?"DEFAULT ":"",r=n!=null&&n.characterSet?`CHARACTER SET='${n==null?void 0:n.characterSet}' `:"",a=n!=null&&n.collation?`COLLATE='${n==null?void 0:n.collation}'`:"",E={tableName:e,defaultKeyword:t,characterSetDefinition:r,collateDefinition:a};return c(T.modifyTableOptions,E).trim()},updateTableComment(e,n){let t={tableName:e,comment:n};return c(T.updateCommentOnTable,t)},dropTableComment(e){let n={tableName:e,comment:"''"};return c(T.updateCommentOnTable,n)},updateSchemaComment(e,n){let t={schemaName:e,comment:n};return c(T.updateCommentOnSchema,t)},dropSchemaComment(e){let n={schemaName:e,comment:"''"};return c(T.updateCommentOnSchema,n)},dropConstraint(e,n){let t={tableName:e,constraintName:n};return c(T.dropConstraint,t)},addCheckConstraint(e,n,t){let r={tableName:e,constraintName:n,expression:t};return c(T.addCheckConstraint,r)},addPrimaryKey(e,n,t){let r=v(T,n)(t),a={tableName:e,constraintStatement:r.statement};return{statement:c(T.addPkConstraint,a),isActivated:n&&r.isActivated}},dropPrimaryKey(e){let n={tableName:e};return c(T.dropPrimaryKey,n)}}}});module.exports=Me();
