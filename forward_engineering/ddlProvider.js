"use strict";var Be=Object.defineProperty;var a=(E,p)=>Be(E,"name",{value:p,configurable:!0});var _=(E,p)=>()=>(p||E((p={exports:{}}).exports,p),p.exports);var ce=_((Xe,se)=>{"use strict";se.exports={number:"NUMBER",string:"TEXT",date:"DATE",timestamp:"TIMESTAMP",binary:"BINARY",boolean:"BIT",document:"LONGTEXT",array:"LONGTEXT",objectId:"VARCHAR(24)",default:"CHAR"}});var Ee=_((ke,me)=>{"use strict";me.exports={TINYINT:{capacity:1},SMALLINT:{capacity:2},MEDIUMINT:{capacity:3},INT:{capacity:4},INTEGER:{capacity:4},BIGINT:{capacity:8},INT1:{capacity:1},INT2:{capacity:2},INT3:{capacity:3},INT4:{capacity:4},INT8:{capacity:8},FLOAT:{capacity:4,mode:"floating"},DOUBLE:{capacity:8,mode:"floating"},"DOUBLE PRECISION":{capacity:8,mode:"floating"},REAL:{capacity:8,mode:"floating"},DECIMAL:{capacity:16,mode:"decimal"},DEC:{capacity:16,mode:"decimal"},NUMERIC:{capacity:16,mode:"decimal"},FIXED:{capacity:16,mode:"decimal"},NUMBER:{capacity:16,mode:"decimal"},CHAR:{size:1},VARCHAR:{mode:"varying"},TINYTEXT:{size:255,mode:"text"},TEXT:{size:65535,mode:"text"},MEDIUMTEXT:{size:16777215,mode:"text"},LONGTEXT:{size:4294967295,mode:"text"},JSON:{size:4294967295,mode:"text"},BINARY:{mode:"binary"},"CHAR BYTE":{mode:"binary"},VARBINARY:{size:2147483649,mode:"binary"},TINYBLOB:{size:255,mode:"binary"},BLOB:{size:65535,mode:"binary"},MEDIUMBLOB:{size:16777215,mode:"binary"},LONGBLOB:{size:4294967295,mode:"binary"},BIT:{mode:"boolean"},DATE:{format:"YYYY-MM-DD"},TIME:{format:"hh:mm:ss.nnnnnn"},DATETIME:{format:"YYYY-MM-DD hh:mm:ss"},TIMESTAMP:{format:"YYYY-MM-DD hh:mm:ss"},YEAR:{format:"YYYY"},INET6:{mode:"ip"},ENUM:{mode:"enum"},SET:{mode:"enum"},GEOMETRY:{format:"euclidian",mode:"geospatial"},POINT:{format:"euclidian",mode:"geospatial"},LINESTRING:{format:"euclidian",mode:"geospatial"},POLYGON:{format:"euclidian",mode:"geospatial"},MULTIPOINT:{format:"euclidian",mode:"geospatial"},MULTILINESTRING:{format:"euclidian",mode:"geospatial"},MULTIPOLYGON:{format:"euclidian",mode:"geospatial"},GEOMETRYCOLLECTION:{format:"euclidian",mode:"geospatial"}}});var Te=_((ze,le)=>{"use strict";le.exports={createDatabase:"CREATE${orReplace} DATABASE${ifNotExist} `${name}`${dbOptions};\n\n${useDb}",createTable:"CREATE ${orReplace}${temporary}TABLE ${ifNotExist}${name} (\n	${column_definitions}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n)${options}${partitions}${selectStatement};\n",createLikeTable:"CREATE ${orReplace}${temporary}TABLE ${ifNotExist}${name} LIKE ${likeTableName};\n",columnDefinition:"`${name}` ${national}${type}${signed}${primary_key}${unique_key}${default}${autoIncrement}${zeroFill}${not_null}${invisible}${compressed}${charset}${collate}${comment}",checkConstraint:"CONSTRAINT ${name}CHECK (${expression})",createForeignKeyConstraint:"CONSTRAINT `${name}` FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey})",createKeyConstraint:"${constraintName}${keyType}${columns}${using}${blockSize}${comment}${ignore}",createForeignKey:"ALTER TABLE ${foreignTable} ADD CONSTRAINT `${name}` FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey});",addCheckConstraint:"ALTER TABLE ${tableName} ADD CONSTRAINT ${constraintName} CHECK (${expression});",addPkConstraint:"ALTER TABLE ${tableName} ADD ${constraintStatement};",dropPrimaryKey:"ALTER TABLE ${tableName} DROP PRIMARY KEY;",dropConstraint:"ALTER TABLE ${tableName} DROP CONSTRAINT ${constraintName};",dropDatabase:"DROP DATABASE IF EXISTS ${databaseName};",dropProcedure:"DROP PROCEDURE IF EXISTS ${procedureName};",dropFunction:"DROP FUNCTION IF EXISTS ${functionName};",updateCommentOnTable:"ALTER TABLE ${tableName} COMMENT ${comment};",updateCommentOnSchema:"ALTER SCHEMA ${schemaName} COMMENT = ${comment};",alterCollation:"ALTER DATABASE ${databaseName} CHARACTER SET=${characterSet} COLLATE=${collation};",dropTable:"DROP TABLE IF EXISTS ${tableName};",dropColumn:"ALTER TABLE IF EXISTS ${tableName} DROP COLUMN IF EXISTS ${columnName};",addColumn:"ALTER TABLE IF EXISTS ${tableName} ADD COLUMN IF NOT EXISTS ${columnDefinition};",modifyColumn:"ALTER TABLE ${tableName} MODIFY COLUMN IF EXISTS ${columnDefinition};",dropView:"DROP VIEW IF EXISTS ${viewName};",renameColumn:"ALTER TABLE IF EXISTS ${tableName} RENAME COLUMN ${oldName} TO ${newName};",modifyTableOptions:"ALTER TABLE ${tableName} ${defaultKeyword}${characterSetDefinition}${collateDefinition};",index:"CREATE ${indexType}INDEX ${ifNotExist}${name}${indexCategory}\n	ON ${table} ( ${keys} )${indexOptions};\n",dropIndex:"ALTER TABLE ${tableName} DROP INDEX IF EXISTS ${indexName};",createView:"CREATE ${orReplace}${algorithm}${sqlSecurity}VIEW ${ifNotExist}${name} AS ${selectStatement}${checkOption};\n",viewSelectStatement:"SELECT ${keys}\n	FROM ${tableName}",createFunction:"CREATE ${orReplace}${aggregate}FUNCTION ${ifNotExist}${name}\n	(${parameters})\n	RETURNS ${type}\n	${characteristics}\n${body}${delimiter}\n",createProcedure:"CREATE ${orReplace}PROCEDURE ${name} (${parameters})\n	${characteristics}\n${body}${delimiter}\n",alterView:"ALTER VIEW ${name}${algorithm}${sqlSecurity} AS ${selectStatement}"}});var Q=_((we,ue)=>{"use strict";var w=class w{name;type;primaryKey;primaryKeyOptions;unique;uniqueKeyOptions;nullable;default;comment;isActivated;scale;precision;length;national;autoIncrement;zerofill;invisible;compressionMethod;enum;synonym;signed;microSecPrecision;charset;collation};a(w,"HydratedColumn");var z=w;ue.exports={HydratedColumn:z}});var J=_((Ze,Ne)=>{"use strict";var j=class j{name;type;nullable;primaryKey;default;length;scale;precision;hasMaxLength;isActivated;unique;zerofill;autoIncrement;invisible;national;comment;charset;compressionMethod;signed;microSecPrecision;enum};a(j,"ColumnDefinition");var Z=j;Ne.exports={ColumnDefinition:Z}});var ne=_((Je,Ie)=>{"use strict";var te=class te{name;isActivated};a(te,"KeyJsonSchema");var ee=te;Ie.exports={KeyJsonSchema:ee}});var pe=_((tt,de)=>{"use strict";var xe=a(({index:E,numberOfStatements:p,lastIndexOfActivatedStatement:y,delimiter:u})=>{let f=E===p-1,R=E===y;return f?"":R?" --"+u:u},"getDelimiter"),qe=a(({statements:E=[],delimiter:p=",",indent:y=`
`})=>{let u=E.findLastIndex(R=>!R.startsWith("--")),f=E.length;return E.map((R,C)=>{let g=xe({index:C,numberOfStatements:f,lastIndexOfActivatedStatement:u,delimiter:p});return R+g}).join(y)},"joinActivatedAndDeactivatedStatements");de.exports={joinActivatedAndDeactivatedStatements:qe}});var Se=_((at,Ae)=>{"use strict";var{ColumnDefinition:rt}=J(),{HydratedColumn:it}=Q();Ae.exports=(E,p)=>{let y=a((i,m)=>`${i}(${m})`,"addLength"),u=a((i,m,B)=>E.isNumber(B)?`${i}(${m},${B})`:`${i}(${m})`,"addScalePrecision"),f=a((i,m)=>`${i}(${m})`,"addPrecision"),R=a(i=>["CHAR","VARCHAR","BINARY","CHAR BYTE","VARBINARY","BLOB"].includes(i),"canHaveLength"),C=a(i=>["TINYINT","SMALLINT","MEDIUMINT","INT","INTEGER","BIGINT","INT1","INT2","INT3","INT4","INT8","FLOAT","DOUBLE","REAL","DECIMAL","DEC","NUMERIC","FIXED","NUMBER","DOUBLE PRECISION","BIT"].includes(i),"isNumeric"),g=a(i=>C(i),"canHavePrecision"),x=a(i=>["TIME","DATETIME","TIMESTAMP"].includes(i),"canHaveMicrosecondPrecision"),b=a(i=>["DECIMAL","FLOAT","DOUBLE","DEC","FIXED","NUMERIC","NUMBER","DOUBLE PRECISION","REAL"].includes(i),"canHaveScale"),Y=a((i,m)=>R(i)&&E.isNumber(m.length)?y(i,m.length):g(i)&&b(i)&&E.isNumber(m.precision)?u(i,m.precision,m.scale):g(i)&&E.isNumber(m.precision)?f(i,m.precision):x(i)&&E.isNumber(m.microSecPrecision)?f(i,m.microSecPrecision):["ENUM","SET"].includes(i)&&!E.isEmpty(m.enum)?`${i}('${m.enum.join("', '")}')`:i,"decorateType"),c=a(i=>["CHAR","VARCHAR","TEXT","TINYTEXT","MEDIUMTEXT","LONGTEXT"].includes(E.toUpper(i)),"isString"),$=a(i=>["TIME","DATE","DATETIME","TIMESTAMP"].includes(i),"isDateTime"),N=a(i=>E.trim(i).replace(/(')+/g,"'$1"),"escapeQuotes");return{decorateType:Y,decorateDefault:a((i,m)=>{let B=["current_timestamp","null"];return(c(i)||$(i))&&!B.includes(E.toLower(m))?p(N(m)):m},"decorateDefault"),canBeNational:a(i=>["CHAR","VARCHAR"].includes(i),"canBeNational"),isNumeric:C,getSign:a((i,m)=>C(i)&&m===!1?" UNSIGNED":"","getSign"),canHaveAutoIncrement:a(i=>["tinyint","smallint","mediumint","int","bigint"].includes(i),"canHaveAutoIncrement")}}});var Ce=_((st,Re)=>{"use strict";var Fe=Object.freeze({ENGINE:"ENGINE",AUTO_INCREMENT:"AUTO_INCREMENT",AVG_ROW_LENGTH:"AVG_ROW_LENGTH",CHECKSUM:"CHECKSUM",DATA_DIRECTORY:"DATA DIRECTORY",DELAY_KEY_WRITE:"DELAY_KEY_WRITE",INDEX_DIRECTORY:"INDEX DIRECTORY",ENCRYPTED:"ENCRYPTED",ENCRYPTION_KEY_ID:"ENCRYPTION_KEY_ID",IETF_QUOTES:"IETF_QUOTES",INSERT_METHOD:"INSERT_METHOD",UNION:"UNION",KEY_BLOCK_SIZE:"KEY_BLOCK_SIZE",MIN_ROWS:"MIN_ROWS",MAX_ROWS:"MAX_ROWS",PACK_KEYS:"PACK_KEYS",PAGE_CHECKSUM:"PAGE_CHECKSUM",PAGE_COMPRESSED:"PAGE_COMPRESSED",PAGE_COMPRESSION_LEVEL:"PAGE_COMPRESSION_LEVEL",ROW_FORMAT:"ROW_FORMAT",SEQUENCE:"SEQUENCE",STATS_AUTO_RECALC:"STATS_AUTO_RECALC",STATS_PERSISTENT:"STATS_PERSISTENT",TRANSACTIONAL:"TRANSACTIONAL",WITH_SYSTEM_VERSIONING:"WITH SYSTEM VERSIONING"}),Ge=Object.freeze({MyISAM:["AUTO_INCREMENT","AVG_ROW_LENGTH","CHECKSUM","DATA_DIRECTORY","DELAY_KEY_WRITE","INDEX_DIRECTORY","KEY_BLOCK_SIZE","PACK_KEYS","ROW_FORMAT","WITH_SYSTEM_VERSIONING"],InnoDB:["AUTO_INCREMENT","DATA_DIRECTORY","INDEX_DIRECTORY","ENCRYPTED","ENCRYPTION_KEY_ID","KEY_BLOCK_SIZE","PACK_KEYS","PAGE_COMPRESSED","PAGE_COMPRESSION_LEVEL","ROW_FORMAT","SEQUENCE","STATS_AUTO_RECALC","STATS_PERSISTENT","WITH_SYSTEM_VERSIONING"],CSV:["IETF_QUOTES","KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"],MERGE:["INSERT_METHOD","UNION","KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"],Aria:["AUTO_INCREMENT","AVG_ROW_LENGTH","CHECKSUM","DATA_DIRECTORY","DELAY_KEY_WRITE","INDEX_DIRECTORY","PAGE_CHECKSUM","ROW_FORMAT","KEY_BLOCK_SIZE","PACK_KEYS","TRANSACTIONAL","WITH_SYSTEM_VERSIONING"],Memory:["AUTO_INCREMENT","KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"],Archive:["AUTO_INCREMENT","KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"]});Re.exports={TableOptions:Fe,TableOptionsByEngine:Ge}});var fe=_((ct,Oe)=>{"use strict";var{TableOptionsByEngine:He,TableOptions:ye}=Ce();Oe.exports=({_:E,wrap:p})=>{let y=a((t,r)=>r?`\`${r}\`.\`${t}\``:`\`${t}\``,"getNamePrefixedWithSchemaName"),u=a((t,r)=>y(t,r),"getTableName"),f=a((t,r)=>y(t,r),"getProcedureName"),R=a((t,r)=>y(t,r),"getUdfName"),C=a(t=>`\`${t}\``,"wrapDbName"),g=a((t,r)=>{if(["ROW_FORMAT","INSERT_METHOD"].includes(t))return r?E.toUpper(r):void 0;if(t==="UNION")return r;if(["YES","NO","DEFAULT"].includes(E.toUpper(r)))return E.toUpper(r);if(typeof r=="number")return r;if(!isNaN(+r)&&r)return+r;if(typeof r=="string"&&r)return p(r);if(typeof r=="boolean")return r?"YES":"NO"},"getOptionValue"),x=a((t="")=>t.replace(/(?<!\\)('|"|`)/gi,"\\$1").replace(/\n/gi,"\\n"),"encodeStringLiteral"),b=a((t={})=>{let r=[],s=t.ENGINE;return t.defaultCharSet||(t.characterSet&&r.push(`CHARSET=${t.characterSet}`),t.collation&&r.push(`COLLATE=${t.collation}`)),s&&r.push(`ENGINE = ${s}`),t.description&&r.push(`COMMENT = '${x(t.description)}'`),(He[s]||["KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"]).forEach(I=>{if(I==="WITH_SYSTEM_VERSIONING")return t[I]?r.push(ye[I]):void 0;let S=g(I,t[I]);if(S===void 0)return;let d=`${ye[I]} = ${S}`;r.push(d)}),r.length?" "+r.join(`,
	`):""},"getTableOptions"),Y=a(t=>t?"LINEAR ":"","addLinear"),c=a(t=>{if(t.partitionType==="SYSTEM_TIME"){let r=!isNaN(t.interval)&&t.interval?` INTERVAL ${t.interval}`:"";return r&&t.time_unit&&(r+=` ${t.time_unit}`),`SYSTEM_TIME${r}`}return`${Y(t.LINEAR)}${t.partitionType}(${E.trim(t.partitioning_expression)})`},"getPartitionBy"),$=a(t=>t.subpartitionType?`SUBPARTITION BY ${Y(t.SUBLINEAR)}${t.subpartitionType}(${E.trim(t.subpartitioning_expression)})`:"","getSubPartitionBy"),N=a(t=>{if(!Array.isArray(t.partition_definitions))return"";let r=t.partition_definitions.filter(({partitionDefinition:s})=>s).map(s=>{let l=s.subpartitionDefinition;return l?s.partitionDefinition+" "+p(l,"(",")"):s.partitionDefinition}).join(`,
		`);return r?p(`
		`+r+`
	`,"(",")"):""},"getPartitionDefinitions"),K=a((t={})=>{if(!t.partitionType)return"";let r=`PARTITION BY ${c(t)}`,s=t.partitions?`PARTITIONS ${t.partitions}`:"",l=$(t),I=t.subpartitions?`SUBPARTITIONS ${t.subpartitions}`:"",S=N(t),d=[r,s,l,I,S].filter(Boolean);return d.length?`
	`+d.join(`
	`):""},"getPartitions"),A=a(t=>t?t.alias?`\`${t.name}\` as \`${t.alias}\``:`\`${t.name}\``:"","getKeyWithAlias"),U=a(t=>Array.isArray(t)?t.reduce((r,s)=>{if(!s.tableName)return r.columns.push(A(s)),r;let l=`\`${s.dbName}\`.\`${s.tableName}\``;return r.tables.includes(l)||r.tables.push(l),r.columns.push({statement:`${l}.${A(s)}`,isActivated:s.isActivated}),r},{tables:[],columns:[]}):{tables:[],columns:[]},"getViewData"),o=a(t=>{let r=[];return t.language&&r.push("LANGUAGE SQL"),t.deterministic&&r.push(t.deterministic),t.sqlSecurity&&r.push(`SQL SECURITY ${t.sqlSecurity}`),t.comment&&r.push(`COMMENT ${p(i(t.comment))}`),r},"getCharacteristics"),i=a((t="")=>t.replace(/(')/gi,"'$1").replace(/\n/gi,"\\n"),"escapeQuotes");return{getTableName:u,getCollectionName:a(t=>(t==null?void 0:t.code)||(t==null?void 0:t.collectionName)||(t==null?void 0:t.name),"getCollectionName"),getCollectionSchema:a(t=>({...t,...E.omit(t==null?void 0:t.role,"properties")||{}}),"getCollectionSchema"),getDatabaseName:a(t=>{var r;return(r=t.compMod)==null?void 0:r.keyspaceName},"getDatabaseName"),wrapDbName:C,getContainerName:a(t=>t.code||t.name||t.collectionName,"getContainerName"),getModifiedGroupItemsByName:a((t=[],r=[])=>{let s=t.filter(S=>!r.some(d=>d.name===S.name)),l=[],I=[];for(let S of r){let d=t.find(L=>L.name===S.name);if(!d){l.push(S);continue}!E.isEqual(d,S)&&I.push(d)}return{added:s,removed:l,modified:I}},"getModifiedGroupItemsByName"),getProcedureName:f,getUdfName:R,getTableOptions:b,getPartitions:K,getViewData:U,getCharacteristics:o,escapeQuotes:i,checkFieldPropertiesChanged:a((t,r)=>r.some(s=>(t==null?void 0:t.oldField[s])!==(t==null?void 0:t.newField[s])),"checkFieldPropertiesChanged"),getCompMod:a(t=>{var r;return((r=t.role)==null?void 0:r.compMod)??{}},"getCompMod"),checkCompModEqual:a(({new:t,old:r}={},s)=>s.isEqual(t,r),"checkCompModEqual"),getViewSchema:a(t=>({...t,...t.role??{}}),"getViewSchema"),getViewName:a(t=>t.code||t.name,"getViewName"),wrapInTics:a(t=>`\`${t}\``,"wrapInTics"),wrapInSingleQuotes:a(t=>`'${t}'`,"wrapInSingleQuotes"),commentIfDeactivated:a((t,{isActivated:r,isPartOfLine:s,inlineComment:l="--"})=>t?r!==!1?t:s?"/* "+t+" */":t.includes(`
`)?`/*
`+t+` */
`:l+" "+t:"","commentIfDeactivated"),getNamePrefixedWithSchemaName:y}}});var $e=_((lt,ge)=>{"use strict";var{KeyJsonSchema:Et}=ne();ge.exports=({_:E,commentIfDeactivated:p,checkAllKeysDeactivated:y,divideIntoActivatedAndDeactivated:u,assignTemplates:f,escapeQuotes:R})=>{let C=a((c,$)=>{var U,o;let N=p(((c==null?void 0:c.deactivatedItems)||[]).join(`,
	`),{isActivated:!$,isPartOfLine:!0}),K=(U=c==null?void 0:c.activatedItems)!=null&&U.length?`,
	`+c.activatedItems.join(`,
	`):"",A=(o=c==null?void 0:c.deactivatedItems)!=null&&o.length?`
	`+N:"";return K+A},"generateConstraintsString"),g=a(c=>{if(Array.isArray(c)){let $=c.filter(A=>E.get(A,"isActivated",!0)).map(A=>`\`${E.trim(A.name)}\``),N=c.filter(A=>!E.get(A,"isActivated",!0)).map(A=>`\`${E.trim(A.name)}\``),K=N.length?p(N,{isActivated:!1,isPartOfLine:!0}):"";return $.join(", ")+K}return c},"foreignKeysToString"),x=a(c=>c.map($=>E.trim($.name)).join(", "),"foreignActiveKeysToString"),b=a((c,$)=>N=>{let K=y(N.columns||[]),A=Y(K,$,N.columns),U=N.category?` USING ${N.category}`:"",o=N.ignore?" IGNORED":"",i=N.comment?` COMMENT '${R(N.comment)}'`:"",m=N.blockSize?` KEY_BLOCK_SIZE=${N.blockSize}`:"";return{statement:f(c.createKeyConstraint,{constraintName:N.name?`CONSTRAINT \`${E.trim(N.name)}\` `:"",keyType:N.keyType,blockSize:m,columns:A,comment:i,ignore:o,using:U}),isActivated:!K}},"createKeyConstraint"),Y=a((c,$,N)=>{var o;if(!N)return"";let K=a(({name:i,order:m})=>`\`${i}\` ${m}`.trim(),"columnMapToString"),A=u(N,K),U=(o=A==null?void 0:A.deactivatedItems)!=null&&o.length?p(A.deactivatedItems.join(", "),{isActivated:!1,isPartOfLine:!0}):"";return!c&&$?" ("+A.activatedItems.join(", ")+U+")":" ("+N.map(K).join(", ")+")"},"getKeyColumns");return{generateConstraintsString:C,foreignKeysToString:g,foreignActiveKeysToString:x,createKeyConstraint:b}}});var Ke=_((ut,Le)=>{"use strict";Le.exports=(E,p)=>{let y=a((o,i)=>Object.entries(o.properties).map(i),"mapProperties"),u=a(o=>o.compositeUniqueKey?!1:o.unique,"isUniqueKey"),f=a(o=>{var i,m;return u(o)&&(((i=o.uniqueKeyOptions)==null?void 0:i.length)===1&&!((m=E.first(o.uniqueKeyOptions))!=null&&m.constraintName)||E.isEmpty(o.uniqueKeyOptions))},"isInlineUnique"),R=a(o=>o.compositeUniqueKey||o.compositePrimaryKey?!1:o.primaryKey,"isPrimaryKey"),C=a(o=>{var i;return R(o)&&!((i=o.primaryKeyOptions)!=null&&i.constraintName)},"isInlinePrimaryKey"),g=a(o=>E.toLower(o)==="asc"?"ASC":E.toLower(o)==="desc"?"DESC":"","getOrder"),x=a(o=>`\`${o.name}\`${o.type==="DESC"?" DESC":""}`,"mapKeyOrder"),b=a((o,i,m)=>p({keyType:"UNIQUE",name:o.constraintName,columns:[{name:i,order:g(o.order),isActivated:m}],category:o.indexCategory,ignore:o.indexIgnore,comment:o.indexComment,blockSize:o.indexBlockSize}),"hydrateUniqueOptions"),Y=a((o,i,m)=>p({keyType:"PRIMARY KEY",name:o.constraintName,columns:[{name:i,order:g(o.order),isActivated:m}],category:o.indexCategory,ignore:o.indexIgnore,comment:o.indexComment,blockSize:o.indexBlockSize}),"hydratePrimaryKeyOptions"),c=a((o,i)=>Object.keys(i).find(m=>i[m].GUID===o),"findName"),$=a((o,i)=>E.get(Object.values(i).find(m=>m.GUID===o),"isActivated",!0),"checkIfActivated"),N=a((o,i)=>o.map(m=>({name:c(m.keyId,i.properties),order:m.type==="descending"?"DESC":"ASC",isActivated:$(m.keyId,i.properties)})),"getKeys"),K=a(o=>Array.isArray(o.primaryKey)?o.primaryKey.filter(i=>!E.isEmpty(i.compositePrimaryKey)).map(i=>({...Y(i),columns:N(i.compositePrimaryKey,o)})):[],"getCompositePrimaryKeys"),A=a(o=>Array.isArray(o.uniqueKey)?o.uniqueKey.filter(i=>!E.isEmpty(i.compositeUniqueKey)).map(i=>({...b(i),columns:N(i.compositeUniqueKey,o)})):[],"getCompositeUniqueKeys");return{getTableKeyConstraints:a(({jsonSchema:o})=>{if(!o.properties)return[];let i=y(o,([B,P])=>{if(!(!R(P)||C(P)))return Y(P.primaryKeyOptions,B,P.isActivated)}).filter(Boolean),m=E.flatten(y(o,([B,P])=>!u(P)||f(P)?[]:(P.uniqueKeyOptions||[]).map(q=>b(q,B,P.isActivated)))).filter(Boolean);return[...i,...K(o),...m,...A(o)]},"getTableKeyConstraints"),isInlineUnique:f,isInlinePrimaryKey:C,hydratePrimaryKeyOptions:Y,hydrateUniqueOptions:b,mapKeyOrder:x}}});var Pe=_((At,be)=>{"use strict";var ve=ce(),Me=Ee(),T=Te(),{HydratedColumn:It}=Q(),{ColumnDefinition:dt}=J(),{KeyJsonSchema:pt}=ne(),{joinActivatedAndDeactivatedStatements:Ve}=pe();be.exports=(E,p,y)=>{let u=y.require("lodash"),{tab:f,commentIfDeactivated:R,checkAllKeysDeactivated:C,divideIntoActivatedAndDeactivated:g,hasType:x,wrap:b,clean:Y}=y.require("@hackolade/ddl-fe-utils").general,{assignTemplates:c}=y.require("@hackolade/ddl-fe-utils"),{decorateDefault:$,decorateType:N,canBeNational:K,getSign:A,canHaveAutoIncrement:U}=Se()(u,b),{getTableName:o,getTableOptions:i,getPartitions:m,getViewData:B,getCharacteristics:P,escapeQuotes:q,wrapInTics:re}=fe()({_:u,wrap:b}),{generateConstraintsString:W,foreignKeysToString:H,foreignActiveKeysToString:X,createKeyConstraint:v}=$e()({_:u,commentIfDeactivated:R,checkAllKeysDeactivated:C,divideIntoActivatedAndDeactivated:g,assignTemplates:c,escapeQuotes:q}),F=Ke()(u,Y),V=a(e=>{let n=u.toUpper(e.type),t=e.nullable?"":" NOT NULL",r=e.primaryKey?" "+v(T,!0)(e.primaryKeyOptions).statement:"",s=e.unique?" "+v(T,!0)(e.uniqueKeyOptions).statement:"",l=e.zerofill?" ZEROFILL":"",I=e.autoIncrement?" AUTO_INCREMENT":"",S=e.invisible?" INVISIBLE":"",d=e.national&&K(n)?"NATIONAL ":"",M=e.comment?` COMMENT '${q(e.comment)}'`:"",L=n!=="JSON"&&e.charset?` CHARSET ${e.charset}`:"",O=n!=="JSON"&&e.charset&&e.collation?` COLLATE ${e.collation}`:"",h=u.isUndefined(e.default)?"":" DEFAULT "+$(n,e.default),D=e.compressionMethod?` COMPRESSED=${e.compressionMethod}`:"",G=A(n,e.signed);return c(T.columnDefinition,{name:e.name,type:N(n,e),not_null:t,primary_key:r,unique_key:s,default:h,autoIncrement:I,compressed:D,signed:G,zeroFill:l,invisible:S,comment:M,national:d,charset:L,collate:O})},"mapColumnToColumnDefinitionDdl");return{createDatabase({databaseName:e,orReplace:n,ifNotExist:t,collation:r,characterSet:s,comments:l,udfs:I,procedures:S,useDb:d=!0}){let M="";M+=s?f(`
CHARACTER SET = '${s}'`):"",M+=r?f(`
COLLATE = '${r}'`):"",M+=l?f(`
COMMENT = '${q(l)}'`):"";let L=c(T.createDatabase,{name:e,orReplace:n&&!t?" OR REPLACE":"",ifNotExist:t?" IF NOT EXISTS":"",dbOptions:M,useDb:d?`USE \`${e}\`;
`:""}),O=I.map(D=>this.createUdf(e,D)),h=S.map(D=>this.createProcedure(e,D));return[L,...O,...h].join(`
`)},createTable({name:e,columns:n,dbData:t,temporary:r,orReplace:s,ifNotExist:l,likeTableName:I,selectStatement:S,options:d,partitioning:M,checkConstraints:L,foreignKeyConstraints:O,keyConstraints:h},D){let G=o(e,t.databaseName),ie=s?"OR REPLACE ":"",ae=r?"TEMPORARY ":"",oe=l?"IF NOT EXISTS ":"";if(I)return c(T.createLikeTable,{name:G,likeTableName:o(I,t.databaseName),orReplace:ie,temporary:ae,ifNotExist:oe});let De=g(h.map(v(T,D)),k=>k.statement),_e=W(De,D),Ye=g(O,k=>k.statement),Ue=W(Ye,D),he=Ve({statements:n,indent:`
	`});return c(T.createTable,{name:G,column_definitions:he,selectStatement:S?` ${S}`:"",orReplace:ie,temporary:ae,ifNotExist:oe,options:i(d),partitions:m(M),checkConstraints:L.length?`,
	`+L.join(`,
	`):"",foreignKeyConstraints:Ue,keyConstraints:_e})},mapColumnToColumnDefinitionDdl:V,convertColumnDefinition(e){let n=V(e),t={isActivated:e.isActivated};return R(n,t)},createIndex(e,n,t,r=!0){if(u.isEmpty(n.indxKey)||!n.indxName)return"";let s=C(n.indxKey),l=n.isActivated===!1||!r||s,I=n.indexType?`${u.toUpper(n.indexType)} `:"",S=n.ifNotExist?"IF NOT EXISTS ":"",d=b(n.indxName,"`","`"),M=o(e,t.databaseName),L=n.indexCategory?` USING ${n.indexCategory}`:"",O=[],h=g(n.indxKey,F.mapKeyOrder),D=h.deactivatedItems.length?R(h.deactivatedItems.join(", "),{isActivated:l,isPartOfLine:!0}):"";u.toLower(n.waitNoWait)==="wait"&&n.waitValue&&O.push(`WAIT ${n.waitValue}`),u.toLower(n.waitNoWait)==="nowait"&&O.push("NOWAIT"),n.indexComment&&O.push(`COMMENT '${q(n.indexComment)}'`),n.indexLock?O.push(`LOCK ${n.indexLock}`):n.indexAlgorithm&&O.push(`ALGORITHM ${n.indexAlgorithm}`);let G=c(T.index,{keys:h.activatedItems.join(", ")+(l&&D&&h.activatedItems.length?", "+D:D),indexOptions:O.length?`
	`+O.join(`
	`):"",name:d,table:M,indexType:I,ifNotExist:S,indexCategory:L});return l?R(G,{isActivated:!1}):G},createCheckConstraint(e){return c(T.checkConstraint,{name:e.name?`${b(e.name,"`","`")} `:"",expression:u.trim(e.expression).replace(/^\(([\s\S]*)\)$/,"$1")})},createForeignKeyConstraint({name:e,foreignKey:n,primaryTable:t,primaryKey:r,primaryTableActivated:s,foreignTableActivated:l,primarySchemaName:I},S,d){let M=C(r),L=C(n),O=!M&&!L&&s&&l;return{statement:c(T.createForeignKeyConstraint,{primaryTable:o(t,I||d.schemaName),name:e,foreignKey:O?H(n):X(n),primaryKey:O?H(r):X(r)}),isActivated:O}},createForeignKey({name:e,foreignTable:n,foreignKey:t,primaryTable:r,primaryKey:s,primaryTableActivated:l,foreignTableActivated:I,foreignSchemaName:S,primarySchemaName:d},M,L){let O=C(s),h=C(t);return{statement:c(T.createForeignKey,{primaryTable:o(r,d||L.schemaName),foreignTable:o(n,S||L.schemaName),name:e,foreignKey:H(t),primaryKey:H(s)}),isActivated:!O&&!h&&l&&I}},createViewForAlterScript(e,n){let{deactivatedWholeStatement:t,selectStatement:r}=this.viewSelectStatement(e),s=e.algorithm&&e.algorithm!=="UNDEFINED"?`ALGORITHM ${e.algorithm} `:"",l=c(T.createView,{name:o(e.name,n),orReplace:e.orReplace?"OR REPLACE ":"",ifNotExist:e.ifNotExist?"IF NOT EXISTS ":"",sqlSecurity:e.sqlSecurity?`SQL SECURITY ${e.sqlSecurity} `:"",checkOption:e.checkOption?`
WITH ${e.checkOption} CHECK OPTION`:"",selectStatement:r,algorithm:s});return{deactivatedWholeStatement:t,statement:l}},createView(e,n,t){let{deactivatedWholeStatement:r,selectStatement:s}=this.viewSelectStatement(e,t),l=e.algorithm&&e.algorithm!=="UNDEFINED"?`ALGORITHM ${e.algorithm} `:"";return R(c(T.createView,{name:o(e.name,n.databaseName),orReplace:e.orReplace?"OR REPLACE ":"",ifNotExist:e.ifNotExist?"IF NOT EXISTS ":"",sqlSecurity:e.sqlSecurity?`SQL SECURITY ${e.sqlSecurity} `:"",checkOption:e.checkOption?`
WITH ${e.checkOption} CHECK OPTION`:"",selectStatement:s,algorithm:l}),{isActivated:!r})},createViewIndex(e,n,t,r){return""},createUdt(e,n){return""},getDefaultType(e){return ve[e]},getTypesDescriptors(){return Me},hasType(e){return x(Me,e)},hydrateColumn({columnDefinition:e,jsonSchema:n,dbData:t}){return{name:e.name,type:e.type,primaryKey:F.isInlinePrimaryKey(n),primaryKeyOptions:u.omit(F.hydratePrimaryKeyOptions(n.primaryKeyOptions||{}),"columns"),unique:F.isInlineUnique(n),uniqueKeyOptions:u.omit(F.hydrateUniqueOptions(u.first(n.uniqueKeyOptions)||{}),"columns"),nullable:e.nullable,default:e.default,comment:e.description||n.refDescription||n.description,isActivated:e.isActivated,scale:e.scale,precision:e.precision,length:e.length,national:n.national,zerofill:n.zerofill,invisible:n.invisible,compressionMethod:n.compressed?n.compression_method:"",enum:n.enum,synonym:n.synonym,signed:n.zerofill||n.signed,microSecPrecision:n.microSecPrecision,charset:n.characterSet,collation:n.collation,...U(e.type)&&{autoIncrement:n.autoincrement}}},hydrateIndex(e,n){return e},hydrateViewIndex(e){return{}},hydrateCheckConstraint(e){return{name:e.chkConstrName,expression:e.constrExpression}},hydrateDatabase(e,n){return{databaseName:e.name,orReplace:e.orReplace,ifNotExist:e.ifNotExist,characterSet:e.characterSet,collation:e.collation,comments:e.description,udfs:((n==null?void 0:n.udfs)||[]).map(this.hydrateUdf),procedures:((n==null?void 0:n.procedures)||[]).map(this.hydrateProcedure)}},hydrateTable({tableData:e,entityData:n,jsonSchema:t}){let r=n[0],s=u.get(e,`relatedSchemas[${r.like}]`,"");return{...e,keyConstraints:F.getTableKeyConstraints({jsonSchema:t}),temporary:r.temporary,orReplace:r.orReplace,ifNotExist:!r.orReplace&&r.ifNotExist,likeTableName:(s==null?void 0:s.code)||(s==null?void 0:s.collectionName),selectStatement:u.trim(r.selectStatement),options:{...r.tableOptions,description:r.description},partitioning:r.partitioning}},hydrateViewColumn(e){return{name:e.name,tableName:e.entityName,alias:e.alias,isActivated:e.isActivated,dbName:e.dbName}},hydrateView({viewData:e,entityData:n,relatedSchemas:t,relatedContainers:r}){let s=n[0];return{name:e.name,tableName:e.tableName,keys:e.keys,orReplace:s.orReplace,ifNotExist:s.ifNotExist,selectStatement:s.selectStatement,sqlSecurity:s.SQL_SECURITY,algorithm:s.algorithm,checkOption:s.withCheckOption?s.checkTestingScope:""}},commentIfDeactivated(e,n,t){return e},hydrateUdf(e){return{name:e.name,delimiter:e.functionDelimiter,orReplace:e.functionOrReplace,aggregate:e.functionAggregate,ifNotExist:e.functionIfNotExist,parameters:e.functionArguments,type:e.functionReturnType,characteristics:{sqlSecurity:e.functionSqlSecurity,language:e.functionLanguage,contains:e.functionContains,deterministic:e.functionDeterministic,comment:e.functionDescription},body:e.functionBody}},hydrateProcedure(e){return{orReplace:e.orReplace,delimiter:e.delimiter,name:e.name,parameters:e.inputArgs,body:e.body,characteristics:{comment:e.comments,contains:e.contains,language:e.language,deterministic:e.deterministic,sqlSecurity:e.securityMode}}},createUdf(e,n){let t=P(n.characteristics),r=n.delimiter?`DELIMITER ${n.delimiter}
`:"",s=n.delimiter?`DELIMITER ;
`:"";return r+c(T.createFunction,{name:o(n.name,e),orReplace:n.orReplace?"OR REPLACE ":"",ifNotExist:n.ifNotExist?"IF NOT EXISTS ":"",aggregate:n.aggregate?"AGGREGATE ":"",characteristics:t.join(`
	`),type:n.type,parameters:n.parameters,body:n.body,delimiter:n.delimiter||";"})+s},createProcedure(e,n){let t=P(n.characteristics),r=n.delimiter?`DELIMITER ${n.delimiter}
`:"",s=n.delimiter?`DELIMITER ;
`:"";return r+c(T.createProcedure,{name:o(n.name,e),orReplace:n.orReplace?"OR REPLACE ":"",parameters:n.parameters,characteristics:t.join(`
	`),body:n.body,delimiter:n.delimiter||";"})+s},dropIndex(e,n,t){let r=o(e,n.databaseName),s=t.name,l=re(s),I={tableName:r,indexName:l};return c(T.dropIndex,I)},viewSelectStatement(e,n=!0){let r=C(e.keys||[])||!n,{columns:s,tables:l}=B(e.keys),I=s.map(d=>d.statement).join(`,
		`);if(!r){let d=g(s,L=>L.statement),M=d.deactivatedItems.length?R(d.deactivatedItems.join(`,
		`),{isActivated:!1,isPartOfLine:!0}):"";I=d.activatedItems.join(`,
		`)+M}let S=u.trim(e.selectStatement)?u.trim(f(e.selectStatement)):c(T.viewSelectStatement,{tableName:l.join(", "),keys:I});return{deactivatedWholeStatement:r,selectStatement:S}},alterView({viewName:e,selectStatement:n,sqlSecurity:t,algorithm:r}){let s={name:e,selectStatement:n,sqlSecurity:t?` ${t}`:"",algorithm:r?` ${r}`:""};return c(T.alterView,s)},dropDatabase(e){let n={databaseName:e};return c(T.dropDatabase,n)},dropProcedure(e){let n={procedureName:e};return c(T.dropProcedure,n)},dropUdf(e){let n={functionName:e};return c(T.dropFunction,n)},alterCollation(e,n,t){let r={databaseName:e,characterSet:n,collation:t};return c(T.alterCollation,r)},dropView(e){let n={viewName:e};return c(T.dropView,n)},dropTable(e){let n={tableName:e};return c(T.dropTable,n)},dropColumn(e,n){let t={tableName:e,columnName:n};return c(T.dropColumn,t)},addColumn(e,n){let t={tableName:e,columnDefinition:n};return c(T.addColumn,t)},renameColumn(e,n,t){let r={tableName:e,oldName:n,newName:t};return c(T.renameColumn,r)},modifyColumn(e,n){let t=V(n),r={tableName:e,columnDefinition:t};return c(T.modifyColumn,r)},modifyTableOptions(e,n){let t=n!=null&&n.defaultCharSet?"DEFAULT ":"",r=n!=null&&n.characterSet?`CHARACTER SET='${n==null?void 0:n.characterSet}' `:"",s=n!=null&&n.collation?`COLLATE='${n==null?void 0:n.collation}'`:"",l={tableName:e,defaultKeyword:t,characterSetDefinition:r,collateDefinition:s};return c(T.modifyTableOptions,l).trim()},updateTableComment(e,n){let t={tableName:e,comment:n};return c(T.updateCommentOnTable,t)},dropTableComment(e){let n={tableName:e,comment:"''"};return c(T.updateCommentOnTable,n)},updateSchemaComment(e,n){let t={schemaName:e,comment:n};return c(T.updateCommentOnSchema,t)},dropSchemaComment(e){let n={schemaName:e,comment:"''"};return c(T.updateCommentOnSchema,n)},dropConstraint(e,n){let t={tableName:e,constraintName:n};return c(T.dropConstraint,t)},addCheckConstraint(e,n,t){let r={tableName:e,constraintName:n,expression:t};return c(T.addCheckConstraint,r)},addPrimaryKey(e,n,t){let r=v(T,n)(t),s={tableName:e,constraintStatement:r.statement};return{statement:c(T.addPkConstraint,s),isActivated:n&&r.isActivated}},dropPrimaryKey(e){let n={tableName:e};return c(T.dropPrimaryKey,n)}}}});module.exports=Pe();
